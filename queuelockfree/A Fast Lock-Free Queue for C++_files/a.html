<!DOCTYPE html>
<!--[if IE 8]><html lang="en" dir="ltr" class="ie8"><![endif]-->
<!--[if IE 9]><html lang="en" dir="ltr" class="ie9"><![endif]-->
<!--[if gt IE 9]><!-->
<html class="js no-touch localstorage sessionstorage contenteditable use-opacity-transitions" dir="ltr" lang="en"><!--<![endif]--><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Disqus Comments</title>

    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    
    <style>
        html {
            overflow: hidden;
        }
        
    </style>

<link media="all" href="a_data/lounge.css" rel="stylesheet"><script src="a_data/config.js" data-requiremodule="remote/config" data-requirecontext="_" async="" charset="utf-8" type="text/javascript"></script><script src="a_data/common.js" data-requiremodule="common.bundle" data-requirecontext="_" async="" charset="utf-8" type="text/javascript"></script><script src="a_data/lounge_002.js" data-requiremodule="lounge.bundle" data-requirecontext="_" async="" charset="utf-8" type="text/javascript"></script><script src="a_data/ga.js" data-requiremodule="ga" data-requirecontext="_" async="" charset="utf-8" type="text/javascript"></script><style id="css_1436372707360"></style><!-- base href="http://disqus.com/embed/comments/?base=default&version=cd0e727d3521b1d2e99d700019236884&f=moodycamel&t_u=http%3A%2F%2Fmoodycamel.com%2Fblog%2F2013%2Fa-fast-lock-free-queue-for-c%2B%2B&t_d=%0A%0AA%20Fast%20Lock-Free%20Queue%20for%20C%2B%2B%0A%0A&t_t=%0A%0AA%20Fast%20Lock-Free%20Queue%20for%20C%2B%2B%0A%0A&s_o=default" --><script charset="UTF-8" async="" src="a_data/event.js"></script><link media="all" href="a_data/discovery.css" rel="stylesheet"><script src="a_data/discovery.js" data-requiremodule="discovery/main" data-requirecontext="_" async="" charset="utf-8" type="text/javascript"></script></head>
<body>
    
    <!--[if lte IE 8]>
<script src="//a.disquscdn.com/1436308898/build/vendor/ie8.js"></script>
<![endif]-->
<!--[if IE 9]>
<script src="//a.disquscdn.com/1436308898/build/vendor/ie9.js"></script>
<![endif]-->

    
<script type="text/json" id="disqus-urls">{
    "root":"//disqus.com",
    "next":"//a.disquscdn.com/next/current/embed"
}</script>

    

    <div id="error" style="display:none; text-align: center">
        <p>We were unable to load Disqus. If you are a moderator please see our <a href="https://docs.disqus.com/help/83/"> troubleshooting guide</a>. </p>
    </div>

    
    <script type="text/json" id="disqus-forumData">{"session":{"canModerate":false,"audienceSyncVerified":false,"canReply":true,"mustVerifyEmail":false},"features":{},"forum":{"category":null,"description":null,"founder":"18992720","settings":{"supportLevel":0,"adsDRNativeEnabled":false,"disable3rdPartyTrackers":false,"moderatorText":null,"ssoRequired":false,"linkAffiliationEnabled":false,"hasCustomAvatar":false,"organicDiscoveryEnabled":false,"colorScheme":"light","discoveryMax":false,"discoverySettingsUrl":"https://moodycamel.disqus.com/admin/settings/ads/","adsVideoEnabled":false,"allowAnonPost":true,"allowMedia":false,"promotedDiscoveryEnabled":false,"allowAnonVotes":false,"mustVerifyEmail":false,"discoveryVariant":null,"adsBannerEnabled":false,"audienceSyncEnabled":false,"typeface":"sans-serif","discoveryLocked":false,"discoveryThumbnailsEnabled":false,"isVIP":false},"url":"http://moodycamel.com","guidelines":null,"favicon":{"permalink":"http://disqus.com/api/forums/favicons/moodycamel.jpg","cache":"//a.disquscdn.com/uploads/forums/112/4748/favicon.png"},"language":"en","avatar":{"small":{"permalink":"http://disqus.com/api/forums/avatars/moodycamel.jpg?size=32","cache":"//a.disquscdn.com/1436308898/images/noavatar32.png"},"large":{"permalink":"http://disqus.com/api/forums/avatars/moodycamel.jpg?size=92","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png"}},"pk":"1124748","signedUrl":"http://disq.us/?url=http%3A%2F%2Fmoodycamel.com&key=M3kxZUPIOsizxVPa2TyxhQ","raw_guidelines":null,"id":"moodycamel","channel":null,"name":"moodycamel.com"}}</script>

    
    <script type="text/json" id="disqus-threadData">{"cursor":{"hasPrev":false,"prev":null,"total":49,"hasNext":false,"next":"1:0:0"},"code":0,"response":{"lastModified":1432570518,"posts":[{"forum":"moodycamel","parent":null,"isApproved":true,"author":{"username":"Ranshalit","about":"","name":"ran","disable3rdPartyTrackers":false,"url":"","isAnonymous":false,"rep":1.234707,"profileUrl":"https://disqus.com/by/Ranshalit/","reputation":1.234707,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2014-10-10T20:37:47","id":"125214668","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/Ranshalit.jpg","cache":"//a.disquscdn.com/uploads/users/12521/4668/avatar32.jpg?1430549819"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/Ranshalit.jpg","cache":"//a.disquscdn.com/uploads/users/12521/4668/avatar92.jpg?1430549819","large":{"permalink":"http://disqus.com/api/users/avatars/Ranshalit.jpg","cache":"//a.disquscdn.com/uploads/users/12521/4668/avatar92.jpg?1430549819"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Hi Cameron,\n\nI have some question about the usage of std::atomic in the implementation.\nIt is said above \"Compiles under MSVC2010+ and GCC 4.7+ (and should work on any C++11 compliant compiler)\"\nBut I read in other place that \"none of the C++11 atomic operations or thread support features are supported by Visual C++ 2010.\".\nI probably missunderstand something... Is there explanation for this ?\n\nThanks!\nRan","createdAt":"2015-05-25T14:50:17","id":"2044344236","thread":"1069844844","depth":0,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Hi Cameron,\u003c/p>\u003cp>I have some question about the usage of std::atomic in the implementation.\u003cbr>It is said above \"Compiles under MSVC2010+ and GCC 4.7+ (and should work on any C++11 compliant compiler)\"\u003cbr>But I read in other place that \"none of the C++11 atomic operations or thread support features are supported by Visual C++ 2010.\".\u003cbr>I probably missunderstand something... Is there explanation for this ?\u003c/p>\u003cp>Thanks!\u003cbr>Ran\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":2044344236,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Good catch. Both statements are true! std::atomic is used conditionally depending on the compiler. For VS2010, I implemented all the equivalent functionality that I use via Microsoft-specific code, while for the other compilers I use std::atomic. This is all encapsulated in atomicops.h, if you're curious.","createdAt":"2015-05-25T16:15:18","id":"2044473213","thread":"1069844844","depth":1,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Good catch. Both statements are true! std::atomic is used conditionally depending on the compiler. For VS2010, I implemented all the equivalent functionality that I use via Microsoft-specific code, while for the other compilers I use std::atomic. This is all encapsulated in atomicops.h, if you're curious.\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":null,"isApproved":true,"author":{"username":"Ranshalit","about":"","name":"ran","disable3rdPartyTrackers":false,"url":"","isAnonymous":false,"rep":1.234707,"profileUrl":"https://disqus.com/by/Ranshalit/","reputation":1.234707,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2014-10-10T20:37:47","id":"125214668","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/Ranshalit.jpg","cache":"//a.disquscdn.com/uploads/users/12521/4668/avatar32.jpg?1430549819"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/Ranshalit.jpg","cache":"//a.disquscdn.com/uploads/users/12521/4668/avatar92.jpg?1430549819","large":{"permalink":"http://disqus.com/api/users/avatars/Ranshalit.jpg","cache":"//a.disquscdn.com/uploads/users/12521/4668/avatar92.jpg?1430549819"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Hi Cameron,\n\nI work on video application (video capture , encode and streaming) and I think of using both the  single consumer-single producer and the multiple consumers queue (encoder for example is the only consumer for the capature video, but the encoder output is consumed by both filesaving module and network streaming module). Anyhow, I would like to ask if you suggest using both implementation (single consumer and multiple consumer), each according to the need in design as listed above, or will it be easier using only the multiple consumer - which seem for me as a better choice in terms of simplicity becuase than I'll need to interface with only this API and implementation in both cases (the single consumer can be used when using the multiple consumer queue too, Right ?).\nWhat do you suggest ?\n\nThank you!","createdAt":"2015-05-18T06:33:04","id":"2031364368","thread":"1069844844","depth":0,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":true,"message":"\u003cp>Hi Cameron,\u003c/p>\u003cp>I work on video application (video capture , encode and streaming) and I think of using both the  single consumer-single producer and the multiple consumers queue (encoder for example is the only consumer for the capature video, but the encoder output is consumed by both filesaving module and network streaming module). Anyhow, I would like to ask if you suggest using both implementation (single consumer and multiple consumer), each according to the need in design as listed above, or will it be easier using only the multiple consumer - which seem for me as a better choice in terms of simplicity becuase than I'll need to interface with only this API and implementation in both cases (the single consumer can be used when using the multiple consumer queue too, Right ?).\u003cbr>What do you suggest ?\u003c/p>\u003cp>Thank you!\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":2031364368,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Yep, I agree that using just one data structure, the multi-producer/multi-consumer queue, would be simpler than integrating both queues. It should work fine for both use cases (SPSC is a strict subset of the generalized MPMC queue problem).","createdAt":"2015-05-18T15:48:10","id":"2031985618","thread":"1069844844","depth":1,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Yep, I agree that using just one data structure, the multi-producer/multi-consumer queue, would be simpler than integrating both queues. It should work fine for both use cases (SPSC is a strict subset of the generalized MPMC queue problem).\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":null,"isApproved":true,"author":{"username":"Ranshalit","about":"","name":"ran","disable3rdPartyTrackers":false,"url":"","isAnonymous":false,"rep":1.234707,"profileUrl":"https://disqus.com/by/Ranshalit/","reputation":1.234707,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2014-10-10T20:37:47","id":"125214668","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/Ranshalit.jpg","cache":"//a.disquscdn.com/uploads/users/12521/4668/avatar32.jpg?1430549819"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/Ranshalit.jpg","cache":"//a.disquscdn.com/uploads/users/12521/4668/avatar92.jpg?1430549819","large":{"permalink":"http://disqus.com/api/users/avatars/Ranshalit.jpg","cache":"//a.disquscdn.com/uploads/users/12521/4668/avatar92.jpg?1430549819"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Hi Cameron,\n\nThank you very much for this valuable information. \nCan the RWQ be used as fixed size ?\n\n\n\n Thanks,\n Ran","createdAt":"2015-05-02T06:55:59","id":"1999042020","thread":"1069844844","depth":0,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":true,"message":"\u003cp>Hi Cameron,\u003c/p>\u003cp>Thank you very much for this valuable information. \u003cbr>Can the RWQ be used as fixed size ?\u003c/p>\u003cp> Thanks,\u003cbr> Ran\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1999042020,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Yes, it can. Simply pass the size to the constructor of the queue, and then use `try_enqueue` instead of `enqueue`, which will fail if there's not enough room instead of allocating more.","createdAt":"2015-05-02T20:06:06","id":"1999859541","thread":"1069844844","depth":1,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Yes, it can. Simply pass the size to the constructor of the queue, and then use `try_enqueue` instead of `enqueue`, which will fail if there's not enough room instead of allocating more.\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1999859541,"isApproved":true,"author":{"username":"Ranshalit","about":"","name":"ran","disable3rdPartyTrackers":false,"url":"","isAnonymous":false,"rep":1.234707,"profileUrl":"https://disqus.com/by/Ranshalit/","reputation":1.234707,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2014-10-10T20:37:47","id":"125214668","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/Ranshalit.jpg","cache":"//a.disquscdn.com/uploads/users/12521/4668/avatar32.jpg?1430549819"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/Ranshalit.jpg","cache":"//a.disquscdn.com/uploads/users/12521/4668/avatar92.jpg?1430549819","large":{"permalink":"http://disqus.com/api/users/avatars/Ranshalit.jpg","cache":"//a.disquscdn.com/uploads/users/12521/4668/avatar92.jpg?1430549819"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Hi Cameron, \nIf I may please ask another question. I thought of using it with vxWorks on PPC. \nIs there anything I should take care of ?\n\nMany Thanks for this public Git,\nRan","createdAt":"2015-05-05T06:37:56","id":"2004732098","thread":"1069844844","depth":2,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Hi Cameron, \u003cbr>If I may please ask another question. I thought of using it with vxWorks on PPC. \u003cbr>Is there anything I should take care of ?\u003c/p>\u003cp>Many Thanks for this public Git,\u003cbr>Ran\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":2004732098,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Of course you may ask :-)\n\n\nIn theory, the queue should work properly out-of-the-box on any platform, since it reverts to standard C++11 primitives on non-special-cased compilers.\n\n\nHowever, I have never tested it with vxWorks, nor on PowerPC. So I'd love to hear how it goes if you do try it! If you come across any incompatibilities (or bugs!), please simply open a GitHub issue and I'll see what I can do to fix them.","createdAt":"2015-05-05T11:20:58","id":"2005375294","thread":"1069844844","depth":3,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Of course you may ask :-)\u003c/p>\u003cp>In theory, the queue should work properly out-of-the-box on any platform, since it reverts to standard C++11 primitives on non-special-cased compilers.\u003c/p>\u003cp>However, I have never tested it with vxWorks, nor on PowerPC. So I'd love to hear how it goes if you do try it! If you come across any incompatibilities (or bugs!), please simply open a GitHub issue and I'll see what I can do to fix them.\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":null,"isApproved":true,"author":{"username":"virgoptrex","about":"","name":"virgoptrex","disable3rdPartyTrackers":false,"url":"","isAnonymous":false,"rep":1.753644,"profileUrl":"https://disqus.com/by/virgoptrex/","reputation":1.753644,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2012-11-17T13:56:39","id":"36730387","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/virgoptrex.jpg","cache":"//a.disquscdn.com/uploads/users/3673/387/avatar32.jpg?1361761297"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/virgoptrex.jpg","cache":"//a.disquscdn.com/uploads/users/3673/387/avatar92.jpg?1361761297","large":{"permalink":"http://disqus.com/api/users/avatars/virgoptrex.jpg","cache":"//a.disquscdn.com/uploads/users/3673/387/avatar92.jpg?1361761297"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"I conducted some further tests and found an interesting tidbit in my C++ code. I used two pthreads (one reader and  one writer) to transfer some data with the lock free queue object declared global. When I run both pthreads and there is *NO* millisleep function in writer thread between each write (or reader thread), everything works fine! I am able to read data correctly in the reader thread. Then I introduce a millisleep 100 ms in writer thread between each writes and the reader is NOT able to read the data anymore. Any idea why? Have you conducted such a test? I would think declaring global queue should not be a problem (it is extern but should not be a problem).","createdAt":"2015-01-08T13:51:31","id":"1778254375","thread":"1069844844","depth":0,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>I conducted some further tests and found an interesting tidbit in my C++ code. I used two pthreads (one reader and  one writer) to transfer some data with the lock free queue object declared global. When I run both pthreads and there is *NO* millisleep function in writer thread between each write (or reader thread), everything works fine! I am able to read data correctly in the reader thread. Then I introduce a millisleep 100 ms in writer thread between each writes and the reader is NOT able to read the data anymore. Any idea why? Have you conducted such a test? I would think declaring global queue should not be a problem (it is extern but should not be a problem).\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1778254375,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"This sounds like a concurrency bug in my queue. (I, too, doubt it's related to it being global.)\nI'd really appreciate it if you could \u003ca href=\"https://github.com/cameron314/readerwriterqueue/issues\">open an issue on github\u003c/a> for this with a compilable test case.","createdAt":"2015-01-08T15:26:57","id":"1778392439","thread":"1069844844","depth":1,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>This sounds like a concurrency bug in my queue. (I, too, doubt it's related to it being global.)\u003cbr>I'd really appreciate it if you could \u003ca href=\"https://github.com/cameron314/readerwriterqueue/issues\" rel=\"nofollow\">open an issue on github\u003c/a> for this with a compilable test case.\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1778392439,"isApproved":true,"author":{"username":"virgoptrex","about":"","name":"virgoptrex","disable3rdPartyTrackers":false,"url":"","isAnonymous":false,"rep":1.753644,"profileUrl":"https://disqus.com/by/virgoptrex/","reputation":1.753644,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2012-11-17T13:56:39","id":"36730387","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/virgoptrex.jpg","cache":"//a.disquscdn.com/uploads/users/3673/387/avatar32.jpg?1361761297"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/virgoptrex.jpg","cache":"//a.disquscdn.com/uploads/users/3673/387/avatar92.jpg?1361761297","large":{"permalink":"http://disqus.com/api/users/avatars/virgoptrex.jpg","cache":"//a.disquscdn.com/uploads/users/3673/387/avatar92.jpg?1361761297"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"I will do that later once I am home, I have to sign up for github. but in the meantime run the following code by changing _DELAY_ macro to 0 or 1. No delay behaviour seems odd. Disqus screwed my indentation so use some program like 'astyle' to get it back.\n\n\n\n//===================== code starts below ========================\n\n//Quick and dirty test by virgoptrex for Cameron's MoodyCamel Lock Free Queue\n//compile using: g++ -g pthread_test.cc -o pthread_test -lpthread -std=c++0x\n\n//Change _DELAY_ value to 1 and 0 to toggle between delay and no delay\n\n#define __STDC_FORMAT_MACROS\n#include \u003cinttypes.h>\n#include \u003cpthread.h>\n#include \u003cstdio.h>\n#include \u003cstdlib.h>\n#include \u003cstdint.h>\n#include \"readerwriterqueue.h\"\n\n#ifndef _DELAY_\n#define _DELAY_ 1\n#endif\n\nmoodycamel::ReaderWriterQueue\u003cuint64_t> queue;\n\nvoid milliseconds_delay(uint32_t milisec)\n{\nstruct timespec req = {0};\nreq.tv_sec = 0;\nreq.tv_nsec = milisec * 1000000L;\nnanosleep(&req, (struct timespec *)NULL);\n}\n\nvoid *Writer(void *threadid)\n{\n   long tid;\n   uint64_t counter = 0;\n   tid = (long)threadid;\n   printf(\"Hello World! It's me, thread #%ld!\\n\", tid);\n   while(1){\n     queue.try_enqueue(counter++);\n     printf(\"sent uint64_t : %\" PRIu64 \"\\n\", counter);\n#if _DELAY_\n     milliseconds_delay(100);\n#endif\n   }\n   pthread_exit(NULL);\n}\n\nvoid *Reader(void *threadid)\n{\n   long tid;\n   tid = (long)threadid;\n   printf(\"Hello World! It's me, thread #%ld!\\n\", tid);\n   while(1){\n     uint64_t value;\n     queue.try_dequeue(value);\n     printf(\"received uint64_t : %\" PRIu64 \"\\n\", value);\n#if _DELAY_\n     milliseconds_delay(100);\n#endif\n   }\n   pthread_exit(NULL);\n}\n\nint main (int argc, char *argv[])\n{\n   pthread_t reader_thread;\n   pthread_t writer_thread;\n   int rc;\n   long t;\n      printf(\"In main: creating reader thread %ld\\n\", t);\n      rc = pthread_create(&reader_thread, NULL, Reader, (void *)0);\n      if (rc){\n         printf(\"ERROR; return code from reader pthread_create() is %d\\n\", rc);\n         exit(-1);\n      }\n      printf(\"In main: creating thread %ld\\n\", t);\n      rc = pthread_create(&writer_thread, NULL, Writer, (void *)1);\n      if (rc){\n         printf(\"ERROR; return code from writer pthread_create() is %d\\n\", rc);\n         exit(-1);\n      }\n\n   /* Last thing that main() should do */\n   pthread_exit(NULL);\n}","createdAt":"2015-01-08T22:53:08","id":"1780039807","thread":"1069844844","depth":2,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":true,"message":"\u003cp>I will do that later once I am home, I have to sign up for github. but in the meantime run the following code by changing _DELAY_ macro to 0 or 1. No delay behaviour seems odd. Disqus screwed my indentation so use some program like 'astyle' to get it back.\u003c/p>\u003cp>//===================== code starts below ========================\u003c/p>\u003cp>//Quick and dirty test by virgoptrex for Cameron's MoodyCamel Lock Free Queue\u003cbr>//compile using: g++ -g \u003ca href=\"http://pthread_test.cc\" rel=\"nofollow\">pthread_test.cc\u003c/a> -o pthread_test -lpthread -std=c++0x\u003c/p>\u003cp>//Change _DELAY_ value to 1 and 0 to toggle between delay and no delay\u003c/p>\u003cp>#define __STDC_FORMAT_MACROS\u003cbr>#include &lt;inttypes.h&gt;\u003cbr>#include &lt;pthread.h&gt;\u003cbr>#include &lt;stdio.h&gt;\u003cbr>#include &lt;stdlib.h&gt;\u003cbr>#include &lt;stdint.h&gt;\u003cbr>#include \"readerwriterqueue.h\"\u003c/p>\u003cp>#ifndef _DELAY_\u003cbr>#define _DELAY_ 1\u003cbr>#endif\u003c/p>\u003cp>moodycamel::ReaderWriterQueue&lt;uint64_t&gt; queue;\u003c/p>\u003cp>void milliseconds_delay(uint32_t milisec)\u003cbr>{\u003cbr>struct timespec req = {0};\u003cbr>req.tv_sec = 0;\u003cbr>req.tv_nsec = milisec * 1000000L;\u003cbr>nanosleep(&amp;req, (struct timespec *)NULL);\u003cbr>}\u003c/p>\u003cp>void *Writer(void *threadid)\u003cbr>{\u003cbr>   long tid;\u003cbr>   uint64_t counter = 0;\u003cbr>   tid = (long)threadid;\u003cbr>   printf(\"Hello World! It's me, thread #%ld!\\n\", tid);\u003cbr>   while(1){\u003cbr>     queue.try_enqueue(counter++);\u003cbr>     printf(\"sent uint64_t : %\" PRIu64 \"\\n\", counter);\u003cbr>#if _DELAY_\u003cbr>     milliseconds_delay(100);\u003cbr>#endif\u003cbr>   }\u003cbr>   pthread_exit(NULL);\u003cbr>}\u003c/p>\u003cp>void *Reader(void *threadid)\u003cbr>{\u003cbr>   long tid;\u003cbr>   tid = (long)threadid;\u003cbr>   printf(\"Hello World! It's me, thread #%ld!\\n\", tid);\u003cbr>   while(1){\u003cbr>     uint64_t value;\u003cbr>     queue.try_dequeue(value);\u003cbr>     printf(\"received uint64_t : %\" PRIu64 \"\\n\", value);\u003cbr>#if _DELAY_\u003cbr>     milliseconds_delay(100);\u003cbr>#endif\u003cbr>   }\u003cbr>   pthread_exit(NULL);\u003cbr>}\u003c/p>\u003cp>int main (int argc, char *argv[])\u003cbr>{\u003cbr>   pthread_t reader_thread;\u003cbr>   pthread_t writer_thread;\u003cbr>   int rc;\u003cbr>   long t;\u003cbr>      printf(\"In main: creating reader thread %ld\\n\", t);\u003cbr>      rc = pthread_create(&amp;reader_thread, NULL, Reader, (void *)0);\u003cbr>      if (rc){\u003cbr>         printf(\"ERROR; return code from reader pthread_create() is %d\\n\", rc);\u003cbr>         exit(-1);\u003cbr>      }\u003cbr>      printf(\"In main: creating thread %ld\\n\", t);\u003cbr>      rc = pthread_create(&amp;writer_thread, NULL, Writer, (void *)1);\u003cbr>      if (rc){\u003cbr>         printf(\"ERROR; return code from writer pthread_create() is %d\\n\", rc);\u003cbr>         exit(-1);\u003cbr>      }\u003c/p>\u003cp>   /* Last thing that main() should do */\u003cbr>   pthread_exit(NULL);\u003cbr>}\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1780039807,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Thanks for the test case! That's awesome. I'll look into as soon as I can (I'm presently at work). I'd still appreciate a GitHub issue, as Disqus seems to have eaten all the formatting. Also, maybe I'm misreading something, but isn't Reader doing the writing and Writer doing the reading?\n\n\nOh, and what's your version of g++?","createdAt":"2015-01-08T23:13:05","id":"1780158342","thread":"1069844844","depth":3,"numReports":0,"isDeletedByAuthor":false,"likes":1,"isEdited":false,"message":"\u003cp>Thanks for the test case! That's awesome. I'll look into as soon as I can (I'm presently at work). I'd still appreciate a GitHub issue, as Disqus seems to have eaten all the formatting. Also, maybe I'm misreading something, but isn't Reader doing the writing and Writer doing the reading?\u003c/p>\u003cp>Oh, and what's your version of g++?\u003c/p>","isSpam":false,"isHighlighted":false,"points":1},{"forum":"moodycamel","parent":1780158342,"isApproved":true,"author":{"username":"virgoptrex","about":"","name":"virgoptrex","disable3rdPartyTrackers":false,"url":"","isAnonymous":false,"rep":1.753644,"profileUrl":"https://disqus.com/by/virgoptrex/","reputation":1.753644,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2012-11-17T13:56:39","id":"36730387","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/virgoptrex.jpg","cache":"//a.disquscdn.com/uploads/users/3673/387/avatar32.jpg?1361761297"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/virgoptrex.jpg","cache":"//a.disquscdn.com/uploads/users/3673/387/avatar92.jpg?1361761297","large":{"permalink":"http://disqus.com/api/users/avatars/virgoptrex.jpg","cache":"//a.disquscdn.com/uploads/users/3673/387/avatar92.jpg?1361761297"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"oh yes you are right. my bad in naming functions. updated names.\n g++ --version\ng++ (Ubuntu/Linaro 4.7.3-2ubuntu1~12.04) 4.7.3\nCopyright (C) 2012 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\nI updated issue on github.","createdAt":"2015-01-09T03:18:17","id":"1781351166","thread":"1069844844","depth":4,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":true,"message":"\u003cp>oh yes you are right. my bad in naming functions. updated names.\u003cbr> g++ --version\u003cbr>g++ (Ubuntu/Linaro 4.7.3-2ubuntu1~12.04) 4.7.3\u003cbr>Copyright (C) 2012 Free Software Foundation, Inc.\u003cbr>This is free software; see the source for copying conditions.  There is NO\u003cbr>warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\u003cbr>I updated issue on github.\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1781351166,"isApproved":true,"author":{"username":"Ranshalit","about":"","name":"ran","disable3rdPartyTrackers":false,"url":"","isAnonymous":false,"rep":1.234707,"profileUrl":"https://disqus.com/by/Ranshalit/","reputation":1.234707,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2014-10-10T20:37:47","id":"125214668","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/Ranshalit.jpg","cache":"//a.disquscdn.com/uploads/users/12521/4668/avatar32.jpg?1430549819"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/Ranshalit.jpg","cache":"//a.disquscdn.com/uploads/users/12521/4668/avatar92.jpg?1430549819","large":{"permalink":"http://disqus.com/api/users/avatars/Ranshalit.jpg","cache":"//a.disquscdn.com/uploads/users/12521/4668/avatar92.jpg?1430549819"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Hi,\nIs this issue been resolved ?\nThanks,\nRan","createdAt":"2015-05-02T07:03:02","id":"1999046561","thread":"1069844844","depth":5,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Hi,\u003cbr>Is this issue been resolved ?\u003cbr>Thanks,\u003cbr>Ran\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":null,"isApproved":true,"author":{"username":"disqus_VJXz5gq0Ai","about":"","name":"Dima","disable3rdPartyTrackers":false,"url":"","isAnonymous":false,"rep":1.2385929999999998,"profileUrl":"https://disqus.com/by/disqus_VJXz5gq0Ai/","reputation":1.2385929999999998,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2013-07-05T15:17:19","id":"60814317","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/disqus_VJXz5gq0Ai.jpg","cache":"//a.disquscdn.com/1436308898/images/noavatar32.png"},"isCustom":false,"permalink":"http://disqus.com/api/users/avatars/disqus_VJXz5gq0Ai.jpg","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png","large":{"permalink":"http://disqus.com/api/users/avatars/disqus_VJXz5gq0Ai.jpg","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"I tested on different Xeon CPUs and winners are SPSC or Folly:\n\nXeon(R) CPU           X5675  @ 3.07GHz\n\nAverage ops/s:\n    ReaderWriterQueue: 198.75 million\n    SPSC queue:        216.68 million\n    Folly queue:       247.67 million\n\nIntel(R) Xeon(R) CPU E5-2650 0 @ 2.00GHz\n\nAverage ops/s:\n    ReaderWriterQueue: 182.79 million\n    SPSC queue:        256.72 million \nFolly queue:       248.20 million","createdAt":"2014-11-12T16:05:00","id":"1689697972","thread":"1069844844","depth":0,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>I tested on different Xeon CPUs and winners are SPSC or Folly:\u003c/p>\u003cp>Xeon(R) CPU           X5675  @ 3.07GHz\u003c/p>\u003cp>Average ops/s:\u003cbr>    ReaderWriterQueue: 198.75 million\u003cbr>    SPSC queue:        216.68 million\u003cbr>    Folly queue:       247.67 million\u003c/p>\u003cp>Intel(R) Xeon(R) CPU E5-2650 0 @ 2.00GHz\u003c/p>\u003cp>Average ops/s:\u003cbr>    ReaderWriterQueue: 182.79 million\u003cbr>    SPSC queue:        256.72 million \u003cbr>Folly queue:       248.20 million\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1689697972,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Interesting. Thanks for the results. What compiler did you use?\n\nFolly's queue was always a bit faster than mine, because it's fixed-size, whereas mine has to deal with the (slight) overhead of potentially multiple linked blocks (this is to support dynamic resizing).\n\nWhat surprises me is the huge jump in performance of the SPSC queue; radically different than in my tests! How much of that is attributable to the dequeue-from-empty case, I wonder?\n\nAnyway, use whichever one is fastest for your circumstances and has the features you need. If you don't need dynamic resizing, go for Folly's. If you don't need to allocate memory upfront, use Dmitry's SPSC queue (if it's faster on your platform). Otherwise, use mine :-)","createdAt":"2014-11-12T16:16:06","id":"1689715386","thread":"1069844844","depth":1,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":true,"message":"\u003cp>Interesting. Thanks for the results. What compiler did you use?\u003c/p>\u003cp>Folly's queue was always a bit faster than mine, because it's fixed-size, whereas mine has to deal with the (slight) overhead of potentially multiple linked blocks (this is to support dynamic resizing).\u003c/p>\u003cp>What surprises me is the huge jump in performance of the SPSC queue; radically different than in my tests! How much of that is attributable to the dequeue-from-empty case, I wonder?\u003c/p>\u003cp>Anyway, use whichever one is fastest for your circumstances and has the features you need. If you don't need dynamic resizing, go for Folly's. If you don't need to allocate memory upfront, use Dmitry's SPSC queue (if it's faster on your platform). Otherwise, use mine :-)\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":null,"isApproved":true,"author":{"username":"virgoptrex","about":"","name":"virgoptrex","disable3rdPartyTrackers":false,"url":"","isAnonymous":false,"rep":1.753644,"profileUrl":"https://disqus.com/by/virgoptrex/","reputation":1.753644,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2012-11-17T13:56:39","id":"36730387","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/virgoptrex.jpg","cache":"//a.disquscdn.com/uploads/users/3673/387/avatar32.jpg?1361761297"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/virgoptrex.jpg","cache":"//a.disquscdn.com/uploads/users/3673/387/avatar92.jpg?1361761297","large":{"permalink":"http://disqus.com/api/users/avatars/virgoptrex.jpg","cache":"//a.disquscdn.com/uploads/users/3673/387/avatar92.jpg?1361761297"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"case memory_order_relaxed: break;\n\n\t\tcase memory_order_acquire: std::atomic_thread_fence(std::memory_order_acquire); break;\n\n\t\tcase memory_order_release: std::atomic_thread_fence(std::memory_order_release); break;\n\n\t\tcase memory_order_acq_rel: std::atomic_thread_fence(std::memory_order_acq_rel); break;\n\n\t\tcase memory_order_seq_cst: std::atomic_thread_fence(std::memory_order_seq_cst); break;\n\ndoes not work on \u003c gcc 4.7 . apparently this is a bug in gcc older versions and needs to be replace by sync_synchronize() or __asm__ __volatile__ ( \"mfence\" ::: \"memory\")","createdAt":"2014-08-27T12:31:04","id":"1561492876","thread":"1069844844","depth":0,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":true,"message":"\u003cp>case memory_order_relaxed: break;\u003c/p>\u003cp>\t\tcase memory_order_acquire: std::atomic_thread_fence(std::memory_order_acquire); break;\u003c/p>\u003cp>\t\tcase memory_order_release: std::atomic_thread_fence(std::memory_order_release); break;\u003c/p>\u003cp>\t\tcase memory_order_acq_rel: std::atomic_thread_fence(std::memory_order_acq_rel); break;\u003c/p>\u003cp>\t\tcase memory_order_seq_cst: std::atomic_thread_fence(std::memory_order_seq_cst); break;\u003c/p>\u003cp>does not work on &lt; gcc 4.7 . apparently this is a bug in gcc older versions and needs to be replace by sync_synchronize() or __asm__ __volatile__ ( \"mfence\" ::: \"memory\")\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1561492876,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Do you mean std::atomic_signal_fence doesn't work in GCC \u003c 4.7? Do you have a link to the bug report?","createdAt":"2014-08-27T14:50:19","id":"1561674790","thread":"1069844844","depth":1,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Do you mean std::atomic_signal_fence doesn't work in GCC &lt; 4.7? Do you have a link to the bug report?\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1561674790,"isApproved":true,"author":{"username":"virgoptrex","about":"","name":"virgoptrex","disable3rdPartyTrackers":false,"url":"","isAnonymous":false,"rep":1.753644,"profileUrl":"https://disqus.com/by/virgoptrex/","reputation":1.753644,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2012-11-17T13:56:39","id":"36730387","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/virgoptrex.jpg","cache":"//a.disquscdn.com/uploads/users/3673/387/avatar32.jpg?1361761297"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/virgoptrex.jpg","cache":"//a.disquscdn.com/uploads/users/3673/387/avatar92.jpg?1361761297","large":{"permalink":"http://disqus.com/api/users/avatars/virgoptrex.jpg","cache":"//a.disquscdn.com/uploads/users/3673/387/avatar92.jpg?1361761297"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Cameron I meant to state atomic_thread_fence not atomic_signal_fence - Apologize for confusion. I have updated my post accordingly. Yes it does not seem to work in GCC \u003c 4.7. I upgraded from GCC 4.6 to 4.7 and it worked fine. See this for bug report http://stackoverflow.com/questions/16429669/stdatomic-thread-fence-has-undefined-reference","createdAt":"2014-08-30T19:38:22","id":"1566661987","thread":"1069844844","depth":2,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":true,"message":"\u003cp>Cameron I meant to state atomic_thread_fence not atomic_signal_fence - Apologize for confusion. I have updated my post accordingly. Yes it does not seem to work in GCC &lt; 4.7. I upgraded from GCC 4.6 to 4.7 and it worked fine. See this for bug report \u003ca href=\"http://stackoverflow.com/questions/16429669/stdatomic-thread-fence-has-undefined-reference\" rel=\"nofollow\">http://stackoverflow.com/quest...\u003c/a>\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1566661987,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Aha, I see. Thanks for letting me know! Pesky compiler bugs.\n\n\nDo you think there's many people stuck on GCC 4.6? I could add a special-case #if directive to fix this by using a full-fence __sync_synchronize instead, but it wouldn't be as fast as the normal atomic_thread_fences since I don't use any full fences in the fast path (the acquire and release fences I use boil down to no-ops on x86, for example).\n\n\nOn a side note, I was about to update the README but I realized it already lists GCC 4.7+ as the minimum supported version ;-) (By chance, not because I knew about the bug.)","createdAt":"2014-09-01T19:34:22","id":"1569291472","thread":"1069844844","depth":3,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Aha, I see. Thanks for letting me know! Pesky compiler bugs.\u003c/p>\u003cp>Do you think there's many people stuck on GCC 4.6? I could add a special-case #if directive to fix this by using a full-fence __sync_synchronize instead, but it wouldn't be as fast as the normal atomic_thread_fences since I don't use any full fences in the fast path (the acquire and release fences I use boil down to no-ops on x86, for example).\u003c/p>\u003cp>On a side note, I was about to update the README but I realized it already lists GCC 4.7+ as the minimum supported version ;-) (By chance, not because I knew about the bug.)\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1569291472,"isApproved":true,"author":{"username":"virgoptrex","about":"","name":"virgoptrex","disable3rdPartyTrackers":false,"url":"","isAnonymous":false,"rep":1.753644,"profileUrl":"https://disqus.com/by/virgoptrex/","reputation":1.753644,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2012-11-17T13:56:39","id":"36730387","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/virgoptrex.jpg","cache":"//a.disquscdn.com/uploads/users/3673/387/avatar32.jpg?1361761297"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/virgoptrex.jpg","cache":"//a.disquscdn.com/uploads/users/3673/387/avatar92.jpg?1361761297","large":{"permalink":"http://disqus.com/api/users/avatars/virgoptrex.jpg","cache":"//a.disquscdn.com/uploads/users/3673/387/avatar92.jpg?1361761297"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Well. Anyone who has updated build tools i.e. post 2013 shouldn't have any issues. I was using Ubuntu 12.04 LTS, that has my tool chain already setup, which ships with 4.6 GCC. I had no issues updating the GCCs to 4.7 on Ubuntu for both native X86 and ARM cross compile build. However, I am not sure if that is the case with other Linux Distros. You could though state this BUG or provide some reference in README file even if you choose to not update the code. Having said that though, it shouldn't be too hard to update GCC IMAO.","createdAt":"2014-09-02T23:25:21","id":"1571156791","thread":"1069844844","depth":4,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Well. Anyone who has updated build tools i.e. post 2013 shouldn't have any issues. I was using Ubuntu 12.04 LTS, that has my tool chain already setup, which ships with 4.6 GCC. I had no issues updating the GCCs to 4.7 on Ubuntu for both native X86 and ARM cross compile build. However, I am not sure if that is the case with other Linux Distros. You could though state this BUG or provide some reference in README file even if you choose to not update the code. Having said that though, it shouldn't be too hard to update GCC IMAO.\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1571156791,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Alright. Thanks for the tips, I don't use Linux very much (just my server's on Fedora, which coincidentally I remember upgrading a while back to get g++ 4.9 for some other features). I'll emphasize in the README that there's a bug in g++ 4.6 that prevents the code from working properly.","createdAt":"2014-09-03T02:13:50","id":"1571336762","thread":"1069844844","depth":5,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Alright. Thanks for the tips, I don't use Linux very much (just my server's on Fedora, which coincidentally I remember upgrading a while back to get g++ 4.9 for some other features). I'll emphasize in the README that there's a bug in g++ 4.6 that prevents the code from working properly.\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":null,"isApproved":true,"author":{"username":"myclassescom","about":"e-Learning provider for all your professional learning requirements","name":"My-Classes.com","disable3rdPartyTrackers":false,"url":"http://my-classes.com/","isAnonymous":false,"rep":1.127737,"profileUrl":"https://disqus.com/by/myclassescom/","reputation":1.127737,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2014-03-25T01:24:07","id":"100248911","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/myclassescom.jpg","cache":"//a.disquscdn.com/uploads/users/10024/8911/avatar32.jpg?1400121846"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/myclassescom.jpg","cache":"//a.disquscdn.com/uploads/users/10024/8911/avatar92.jpg?1400121846","large":{"permalink":"http://disqus.com/api/users/avatars/myclassescom.jpg","cache":"//a.disquscdn.com/uploads/users/10024/8911/avatar92.jpg?1400121846"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Very interesting work. The performance comparison looks great. Few follow-up questions, \n\n\n1. Wondering what would it take to convert this into 'multiple producer and multiple consumer' scenario, or at-least single producer, multiple consumer.\n\n\n2. What would be your suggestion to make this 'event oriented'. Lets say, the queue has certain 'observer(s)' who would be interested in getting notified (callback) about the availability of an item in the queue. \n\n\nThe reason for the second option is: even though the data-structure is very fast, in real world, one would need a dedicated thread to 'poll' over the queue (e.g. the consumer has to keep asking 'you got something for me'), which degraded overall system performance. If event system (such as libsigc++) can be combined with this, it would be very useful for real-world scenarios. If you could throw some pointers, we would be happy to integrate this queue with event system. Appreciate any pointers.","createdAt":"2014-05-12T10:19:22","id":"1380760115","thread":"1069844844","depth":0,"numReports":0,"isDeletedByAuthor":false,"likes":1,"isEdited":false,"message":"\u003cp>Very interesting work. The performance comparison looks great. Few follow-up questions,\u003c/p>\u003cp>1. Wondering what would it take to convert this into 'multiple producer and multiple consumer' scenario, or at-least single producer, multiple consumer.\u003c/p>\u003cp>2. What would be your suggestion to make this 'event oriented'. Lets say, the queue has certain 'observer(s)' who would be interested in getting notified (callback) about the availability of an item in the queue.\u003c/p>\u003cp>The reason for the second option is: even though the data-structure is very fast, in real world, one would need a dedicated thread to 'poll' over the queue (e.g. the consumer has to keep asking 'you got something for me'), which degraded overall system performance. If event system (such as libsigc++) can be combined with this, it would be very useful for real-world scenarios. If you could throw some pointers, we would be happy to integrate this queue with event system. Appreciate any pointers.\u003c/p>","isSpam":false,"isHighlighted":false,"points":1},{"forum":"moodycamel","parent":1380760115,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Hi :-)\n\n1. Nope, not possible. The design is fundamentally limited to a single producer and consumer. Having said that, I'm working on a full multiple-consumer, multiple-producer queue (I need to write some more tests and documentation, but the queue itself is pretty much done). Stay tuned!\n\n2. Hmm, interesting. This would use OS-level events to provide fast low-overhead blocking behaviour? I'm not sure I like the callback part, as the callback would necessarily be on the producer thread, and if you dequeued within the callback, no other thread would ever be able to dequeue simultaneously -- which brings you right back to a single-threaded queue, in which case you don't need anything to be lock-free and you can use a faster thread-oblivious queue. But a low-overhead blocking model would be interesting (the cost of the extra polling thread would be low if it's just waiting on an OS handle most of the time).\n\nYou can implement your own blocking queue on top of mine fairly easily, without having to modify any of the code -- simply wrap it inside another class that provides equivalent enqueue/dequeue functionality, except that *after* any enqueue operation completes, it increments a semaphore. Then you can add a 'dequeue_wait' method that blocks on the semaphore (and a regular 'try_dequeue' method, if needed, that also decrements the semaphore after an item is successfully removed). This is similar to how the .NET framework implements its BlockingCollection&lt;T&gt; class, by the way.","createdAt":"2014-05-12T18:16:48","id":"1381323417","thread":"1069844844","depth":1,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":true,"message":"\u003cp>Hi :-)\u003c/p>\u003cp>1. Nope, not possible. The design is fundamentally limited to a single producer and consumer. Having said that, I'm working on a full multiple-consumer, multiple-producer queue (I need to write some more tests and documentation, but the queue itself is pretty much done). Stay tuned!\u003c/p>\u003cp>2. Hmm, interesting. This would use OS-level events to provide fast low-overhead blocking behaviour? I'm not sure I like the callback part, as the callback would necessarily be on the producer thread, and if you dequeued within the callback, no other thread would ever be able to dequeue simultaneously -- which brings you right back to a single-threaded queue, in which case you don't need anything to be lock-free and you can use a faster thread-oblivious queue. But a low-overhead blocking model would be interesting (the cost of the extra polling thread would be low if it's just waiting on an OS handle most of the time).\u003c/p>\u003cp>You can implement your own blocking queue on top of mine fairly easily, without having to modify any of the code -- simply wrap it inside another class that provides equivalent enqueue/dequeue functionality, except that *after* any enqueue operation completes, it increments a semaphore. Then you can add a 'dequeue_wait' method that blocks on the semaphore (and a regular 'try_dequeue' method, if needed, that also decrements the semaphore after an item is successfully removed). This is similar to how the .NET framework implements its BlockingCollection&lt;T&gt; class, by the way.\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1381323417,"isApproved":true,"author":{"username":"myclassescom","about":"e-Learning provider for all your professional learning requirements","name":"My-Classes.com","disable3rdPartyTrackers":false,"url":"http://my-classes.com/","isAnonymous":false,"rep":1.127737,"profileUrl":"https://disqus.com/by/myclassescom/","reputation":1.127737,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2014-03-25T01:24:07","id":"100248911","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/myclassescom.jpg","cache":"//a.disquscdn.com/uploads/users/10024/8911/avatar32.jpg?1400121846"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/myclassescom.jpg","cache":"//a.disquscdn.com/uploads/users/10024/8911/avatar92.jpg?1400121846","large":{"permalink":"http://disqus.com/api/users/avatars/myclassescom.jpg","cache":"//a.disquscdn.com/uploads/users/10024/8911/avatar92.jpg?1400121846"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Thank you. Will wait for MPMC queue. Your work will surely help many. And thank you for the pointers. Will try to experiment on adding events to the queue.\n\n\nJust one quick question: It might be obvious, but just to want to confirm: the performance comparison in the article showcases performance across similar lock-free implementation, and yours is better. But, does this also imply this lock-free implementation performs better than any other existing locked (e.g. mutexes)  versions? Do you happen to have any rough study that indicates the speed-up factor against the locked implementations (to convince the non-believers)?\n\n\nThe reason is: we recently came across few libraries that use 'memory barriers' to achieve parallelism - but the cost of 'memory barrier' is so high that it is utterly unusable for practical problems -  a simple spinlock / CS could have given far better performance. Hope that is not the case here.","createdAt":"2014-05-14T12:20:56","id":"1384406863","thread":"1069844844","depth":2,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Thank you. Will wait for MPMC queue. Your work will surely help many. And thank you for the pointers. Will try to experiment on adding events to the queue.\u003c/p>\u003cp>Just one quick question: It might be obvious, but just to want to confirm: the performance comparison in the article showcases performance across similar lock-free implementation, and yours is better. But, does this also imply this lock-free implementation performs better than any other existing locked (e.g. mutexes)  versions? Do you happen to have any rough study that indicates the speed-up factor against the locked implementations (to convince the non-believers)?\u003c/p>\u003cp>The reason is: we recently came across few libraries that use 'memory barriers' to achieve parallelism - but the cost of 'memory barrier' is so high that it is utterly unusable for practical problems -  a simple spinlock / CS could have given far better performance. Hope that is not the case here.\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1384406863,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Right, so, my queue is not always the fastest, actually -- the folly one is faster -- though the folly queue is fixed-size while mine is can expand dynamically (and this difference is the fundamental reason for the performance difference).\n\n\nI haven't benchmarked a lock-based queue, but the benefits that a lock-based design give (not having to worry about other threads executing) would be minuscule in this case, since the overhead of my design compared to a single-threaded one is very low (the hoops I jump through to achieve safe lock-free synchronization are minimal in terms of implementation complexity, even if the underlying algorithms are more involved than their non-threaded cousins). The overhead of a mutex-based version would be higher than what I do now, since I do almost no synchronization (at least, not any explicit synchronization). The producer and consumer threads are more-or-less independent, looking only at a bit of each other's data here and there to see if there's any elements to dequeue or enough room to enqueue.\n\n\nThe entire reason I wrote this queue was because I wanted to avoid the overhead of a lock-based one :-) It's designed to be highly efficient under heavy contention, whereas a lock-based version would be alright under low contention, and very slow (comparatively) under high contention.\n\n\nBenchmarking a lock/mutex/CS based version would be interesting, but it depends heavily on the implementation of the lock (with the fastest versions generally being supplied by the OS). For example, I do in fact have a benchmark of such a queue for my MPMC queue project, and the implementation of std::mutex on MinGW (on Windows) is so poor that it regularly performs 100-1000x worse than any of the other lock-free queues I compare it to. But the same code on Linux usually has a speed difference within an order of magnitude (though still slower (sometimes *much* slower) on average).\n\n\nAs for memory barriers, my queue uses them all over the place! It is impossible to write a correct lock-free queue without them. I'm not sure why you think memory barriers are expensive (I suppose it depends on the barrier and on the hardware, but the two most common barriers, 'acquire' and 'release' are no-ops on the most common processor, x86).\n\n\nI hope my rambling helps answer your questions? ;-)","createdAt":"2014-05-14T13:49:51","id":"1384542216","thread":"1069844844","depth":3,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":true,"message":"\u003cp>Right, so, my queue is not always the fastest, actually -- the folly one is faster -- though the folly queue is fixed-size while mine is can expand dynamically (and this difference is the fundamental reason for the performance difference).\u003c/p>\u003cp>I haven't benchmarked a lock-based queue, but the benefits that a lock-based design give (not having to worry about other threads executing) would be minuscule in this case, since the overhead of my design compared to a single-threaded one is very low (the hoops I jump through to achieve safe lock-free synchronization are minimal in terms of implementation complexity, even if the underlying algorithms are more involved than their non-threaded cousins). The overhead of a mutex-based version would be higher than what I do now, since I do almost no synchronization (at least, not any explicit synchronization). The producer and consumer threads are more-or-less independent, looking only at a bit of each other's data here and there to see if there's any elements to dequeue or enough room to enqueue.\u003c/p>\u003cp>The entire reason I wrote this queue was because I wanted to avoid the overhead of a lock-based one :-) It's designed to be highly efficient under heavy contention, whereas a lock-based version would be alright under low contention, and very slow (comparatively) under high contention.\u003c/p>\u003cp>Benchmarking a lock/mutex/CS based version would be interesting, but it depends heavily on the implementation of the lock (with the fastest versions generally being supplied by the OS). For example, I do in fact have a benchmark of such a queue for my MPMC queue project, and the implementation of std::mutex on MinGW (on Windows) is so poor that it regularly performs 100-1000x worse than any of the other lock-free queues I compare it to. But the same code on Linux usually has a speed difference within an order of magnitude (though still slower (sometimes *much* slower) on average).\u003c/p>\u003cp>As for memory barriers, my queue uses them all over the place! It is impossible to write a correct lock-free queue without them. I'm not sure why you think memory barriers are expensive (I suppose it depends on the barrier and on the hardware, but the two most common barriers, 'acquire' and 'release' are no-ops on the most common processor, x86).\u003c/p>\u003cp>I hope my rambling helps answer your questions? ;-)\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1384542216,"isApproved":true,"author":{"username":"myclassescom","about":"e-Learning provider for all your professional learning requirements","name":"My-Classes.com","disable3rdPartyTrackers":false,"url":"http://my-classes.com/","isAnonymous":false,"rep":1.127737,"profileUrl":"https://disqus.com/by/myclassescom/","reputation":1.127737,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2014-03-25T01:24:07","id":"100248911","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/myclassescom.jpg","cache":"//a.disquscdn.com/uploads/users/10024/8911/avatar32.jpg?1400121846"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/myclassescom.jpg","cache":"//a.disquscdn.com/uploads/users/10024/8911/avatar92.jpg?1400121846","large":{"permalink":"http://disqus.com/api/users/avatars/myclassescom.jpg","cache":"//a.disquscdn.com/uploads/users/10024/8911/avatar92.jpg?1400121846"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Thank you for the detailed answer Cameron. Yes, it clarified the differences.\n\nMemory barriers, perhaps as you said, depend again on the OS or particular implementation. Recently we were benchmarking the standard 'ThreadRing' problem on one of the parallel libraries which uses lock-free queues. In this particular case the challenge is to create 503 creates and send a token around in a loop across the threads. What we observed was all the 503 threads had to spend at least few seconds (about 5 to 10 seconds) just to get across the memory barrier on Windows (did not check it on Linux variants).\n\nPerhaps its the high thread count (503) that caused the delay with the barrier. If that is the case, then SPSC queues may not have this problem since they expect one or two threads to access it at any point of time. However, for MPMC , since it involves multiple threads using the barriers, it might be affected by this problem (not sure). (Here is the original challenge: http://benchmarksgame.alioth.debian.org/u32/performance.php?test=threadring )\n\n\nOn this MPMC I have a follow-up question: we have this real world scenario where we are looking for a good design, and hence benchmarking the parallel libraries - but couldn't come close to any - perhaps you could throw some light.\n\n\nLet us say, we have multiple producers that have to distribute work items to multiple consumers. The challenge is:\n1. We should achieve maximum throughput and performance under heavy load\n2. under no load, the system cpu-usage and resource usage should be near zero\nCan MPMC solve this problem, especially the second part?\n\n\nI know, under heavy load, the work-hungry consumers can keep dequeuing the items from MPMC as fast as they can in a loop inside a thread. But under no load, what does each of those consumers do? Just busy wait?? (since there is no lock primitive and nothing to consume)\n\n\nWhat is your view on how to solve this zero-work under zero-load for MPMC?","createdAt":"2014-05-15T02:44:04","id":"1386381375","thread":"1069844844","depth":4,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Thank you for the detailed answer Cameron. Yes, it clarified the differences.\u003c/p>\u003cp>Memory barriers, perhaps as you said, depend again on the OS or particular implementation. Recently we were benchmarking the standard 'ThreadRing' problem on one of the parallel libraries which uses lock-free queues. In this particular case the challenge is to create 503 creates and send a token around in a loop across the threads. What we observed was all the 503 threads had to spend at least few seconds (about 5 to 10 seconds) just to get across the memory barrier on Windows (did not check it on Linux variants).\u003c/p>\u003cp>Perhaps its the high thread count (503) that caused the delay with the barrier. If that is the case, then SPSC queues may not have this problem since they expect one or two threads to access it at any point of time. However, for MPMC , since it involves multiple threads using the barriers, it might be affected by this problem (not sure). (Here is the original challenge: \u003ca href=\"http://benchmarksgame.alioth.debian.org/u32/performance.php?test=threadring\" rel=\"nofollow\">http://benchmarksgame.alioth.d...\u003c/a> )\u003c/p>\u003cp>On this MPMC I have a follow-up question: we have this real world scenario where we are looking for a good design, and hence benchmarking the parallel libraries - but couldn't come close to any - perhaps you could throw some light.\u003c/p>\u003cp>Let us say, we have multiple producers that have to distribute work items to multiple consumers. The challenge is:\u003cbr>1. We should achieve maximum throughput and performance under heavy load\u003cbr>2. under no load, the system cpu-usage and resource usage should be near zero\u003cbr>Can MPMC solve this problem, especially the second part?\u003c/p>\u003cp>I know, under heavy load, the work-hungry consumers can keep dequeuing the items from MPMC as fast as they can in a loop inside a thread. But under no load, what does each of those consumers do? Just busy wait?? (since there is no lock primitive and nothing to consume)\u003c/p>\u003cp>What is your view on how to solve this zero-work under zero-load for MPMC?\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1386381375,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Hmm, 503 threads sounds like an awful lot for a machine with \u003c100 cores. You'd need to get help from the OS to have any hope of it being fast at all (e.g. by using blocking OS primitives like semaphores or events). I know that on Windows, just \u003cem>creating\u003c/em> 503 threads could take a while. In practice, you'd never want that many threads active at once (there's a reason that thread pools are popular). At that point, you're adding significant overhead for zero benefit.\n\nMemory barriers are lower-level than the OS, actually -- they're implemented directly in hardware (different instructions have different memory barrier semantics, and the memory barriers expressed in, say, C++, cause the compiler to select different instructions). On x86, for example, all loads have acquire semantics, and all stores have release semantics (so acquire and release are no-ops on x86, but still have to be written in the code to avoid the compiler re-ordering instructions -- and for portability). Some atomic instructions (with the 'lock' prefix) have stronger guarantees, I believe, and a full fence has a dedicated instruction ('mfence').\n\nActually, how do you know the time taken is being lost to memory barriers? How are you measuring this?\n\nIf you want maximum throughput (as most lock-free queues are designed for), then polling is the way to go. This is because busy-waiting has lower latency than telling the OS to put your thread to sleep (or block on a semaphore, say) and then waking it up later, since the time between incoming elements is in the sub-microsecond range.\n\nIf you don't have that high rate of incoming elements (and processing them generally eclipses the overhead of the queue itself, by the way), then by definition you don't have a high-throughput situation. In that case, you can trade some latency (and total throughput capacity) for lower overhead in the dry spells; one way to do this, as I mentioned, would be to use an OS semaphore to track the number of elements in the queue, and block on the semaphore before dequeueing. Since you want to also scale to high-throughput, then you could busy-wait poll for, say, half a millisecond before blocking the thread on the semaphore (this would improve the latency, but you'd still have to pay the overhead of managing the semaphore). This is what I would do in such a situation. Unfortunately, there's no way to avoid \u003cem>some\u003c/em> extra overhead to reduce busy-waiting, because it is not something that can be done without cooperation with the OS (even if you're working with a thread pool and there are other tasks that can be done while the threads are waiting, thus avoiding actual blocking/sleeping, it's the same overhead except that the implementation is in userland instead of the OS).\n\nI'm curious -- what real-world scenario requires a high-throughput multithreaded queue but has traffic so bursty that the dry spells are long enough to warrant sleeping the threads?","createdAt":"2014-05-20T13:38:05","id":"1395585051","thread":"1069844844","depth":5,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Hmm, 503 threads sounds like an awful lot for a machine with &lt;100 cores. You'd need to get help from the OS to have any hope of it being fast at all (e.g. by using blocking OS primitives like semaphores or events). I know that on Windows, just \u003cem>creating\u003c/em> 503 threads could take a while. In practice, you'd never want that many threads active at once (there's a reason that thread pools are popular). At that point, you're adding significant overhead for zero benefit.\u003c/p>\u003cp>Memory barriers are lower-level than the OS, actually -- they're implemented directly in hardware (different instructions have different memory barrier semantics, and the memory barriers expressed in, say, C++, cause the compiler to select different instructions). On x86, for example, all loads have acquire semantics, and all stores have release semantics (so acquire and release are no-ops on x86, but still have to be written in the code to avoid the compiler re-ordering instructions -- and for portability). Some atomic instructions (with the 'lock' prefix) have stronger guarantees, I believe, and a full fence has a dedicated instruction ('mfence').\u003c/p>\u003cp>Actually, how do you know the time taken is being lost to memory barriers? How are you measuring this?\u003c/p>\u003cp>If you want maximum throughput (as most lock-free queues are designed for), then polling is the way to go. This is because busy-waiting has lower latency than telling the OS to put your thread to sleep (or block on a semaphore, say) and then waking it up later, since the time between incoming elements is in the sub-microsecond range.\u003c/p>\u003cp>If you don't have that high rate of incoming elements (and processing them generally eclipses the overhead of the queue itself, by the way), then by definition you don't have a high-throughput situation. In that case, you can trade some latency (and total throughput capacity) for lower overhead in the dry spells; one way to do this, as I mentioned, would be to use an OS semaphore to track the number of elements in the queue, and block on the semaphore before dequeueing. Since you want to also scale to high-throughput, then you could busy-wait poll for, say, half a millisecond before blocking the thread on the semaphore (this would improve the latency, but you'd still have to pay the overhead of managing the semaphore). This is what I would do in such a situation. Unfortunately, there's no way to avoid \u003cem>some\u003c/em> extra overhead to reduce busy-waiting, because it is not something that can be done without cooperation with the OS (even if you're working with a thread pool and there are other tasks that can be done while the threads are waiting, thus avoiding actual blocking/sleeping, it's the same overhead except that the implementation is in userland instead of the OS).\u003c/p>\u003cp>I'm curious -- what real-world scenario requires a high-throughput multithreaded queue but has traffic so bursty that the dry spells are long enough to warrant sleeping the threads?\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":null,"isApproved":true,"author":{"username":"artemsaveliev","about":"software architect","name":"Artem Saveliev","disable3rdPartyTrackers":false,"url":"http://artem.savelev.com","isAnonymous":false,"rep":1.233231,"profileUrl":"https://disqus.com/by/artemsaveliev/","reputation":1.233231,"location":"NY Metro","isPrivate":false,"isPrimary":true,"joinedAt":"2014-04-09T18:49:52","id":"102447862","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/artemsaveliev.jpg","cache":"//a.disquscdn.com/1436308898/images/noavatar32.png"},"isCustom":false,"permalink":"http://disqus.com/api/users/avatars/artemsaveliev.jpg","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png","large":{"permalink":"http://disqus.com/api/users/avatars/artemsaveliev.jpg","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"I was trying to understand how lock-free is actually achieved - people rarely explain that this is still a lock but in hardware. So it's a great summary! I just wanted to confirm that even with better ram model, we will still have locks, but explicit in hardware - not in this hacked cache coherence way.\n\n\nHave you looked at how Intel TSX works, and would that (at least conceptually) help?","createdAt":"2014-04-09T18:56:03","id":"1326968763","thread":"1069844844","depth":0,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>I was trying to understand how lock-free is actually achieved - people rarely explain that this is still a lock but in hardware. So it's a great summary! I just wanted to confirm that even with better ram model, we will still have locks, but explicit in hardware - not in this hacked cache coherence way.\u003c/p>\u003cp>Have you looked at how Intel TSX works, and would that (at least conceptually) help?\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1326968763,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Actually, it's not really a lock in a cache coherency model -- the hardware ensures atomicity, but not mutual exclusion. If it was a proper lock, then deadlocks could occur, and threads interrupting each other could cause priority inversion. I'm not sure where the future of hardware is going, but apparently Intel and others claims the cache-coherency model can scale even with many CPU cores (I think this is because memory bandwidth remains the real bottleneck).\n\n\nUnfortunately, I haven't looked into transactional memory, so I can't comment on TSX.","createdAt":"2014-04-09T19:50:13","id":"1327089412","thread":"1069844844","depth":1,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Actually, it's not really a lock in a cache coherency model -- the hardware ensures atomicity, but not mutual exclusion. If it was a proper lock, then deadlocks could occur, and threads interrupting each other could cause priority inversion. I'm not sure where the future of hardware is going, but apparently Intel and others claims the cache-coherency model can scale even with many CPU cores (I think this is because memory bandwidth remains the real bottleneck).\u003c/p>\u003cp>Unfortunately, I haven't looked into transactional memory, so I can't comment on TSX.\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1327089412,"isApproved":true,"author":{"username":"artemsaveliev","about":"software architect","name":"Artem Saveliev","disable3rdPartyTrackers":false,"url":"http://artem.savelev.com","isAnonymous":false,"rep":1.233231,"profileUrl":"https://disqus.com/by/artemsaveliev/","reputation":1.233231,"location":"NY Metro","isPrivate":false,"isPrimary":true,"joinedAt":"2014-04-09T18:49:52","id":"102447862","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/artemsaveliev.jpg","cache":"//a.disquscdn.com/1436308898/images/noavatar32.png"},"isCustom":false,"permalink":"http://disqus.com/api/users/avatars/artemsaveliev.jpg","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png","large":{"permalink":"http://disqus.com/api/users/avatars/artemsaveliev.jpg","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Yes, I understand that there's no transactions here - but it's a hardware-assisted way to write lock-free code. It was just hard to understand this bit - people keep mentioning compare-and-swap as primary way to implement lock-free code, but on the surface (in C implementation) it doesn't look like it's thread-safe, until you understand that two lines (compare, swap) convert into one in asm (i.e. cmpxchg16b)\n\nIt looks like memory fetching still trumps cache synchronization by 100x or more. So in real applications, that don't just deal with cached data, it is not a major factor. Well, until we get 100 cores that is :)\n\nThe interesting thing about TSX, in the version that's called \"Restricted Transactional Memory\" is that it does indeed have transaction failure and fallback mechanism that can be set up by the developer. What's annoying is that Intel is not describing how it works internally, so people actually have to research it as a black box...\n\nAccording to wiki, they may be changing how it works under the hood in couple of generations, that's when we should be approaching the tens of cores.","createdAt":"2014-04-10T15:05:08","id":"1329264413","thread":"1069844844","depth":2,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Yes, I understand that there's no transactions here - but it's a hardware-assisted way to write lock-free code. It was just hard to understand this bit - people keep mentioning compare-and-swap as primary way to implement lock-free code, but on the surface (in C implementation) it doesn't look like it's thread-safe, until you understand that two lines (compare, swap) convert into one in asm (i.e. cmpxchg16b)\u003c/p>\u003cp>It looks like memory fetching still trumps cache synchronization by 100x or more. So in real applications, that don't just deal with cached data, it is not a major factor. Well, until we get 100 cores that is :)\u003c/p>\u003cp>The interesting thing about TSX, in the version that's called \"Restricted Transactional Memory\" is that it does indeed have transaction failure and fallback mechanism that can be set up by the developer. What's annoying is that Intel is not describing how it works internally, so people actually have to research it as a black box...\u003c/p>\u003cp>According to wiki, they may be changing how it works under the hood in couple of generations, that's when we should be approaching the tens of cores.\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":null,"isApproved":true,"author":{"username":"yvanvandersanden","about":"","name":"yvan vander sanden","disable3rdPartyTrackers":false,"url":"","isAnonymous":false,"rep":1.233796,"profileUrl":"https://disqus.com/by/yvanvandersanden/","reputation":1.233796,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2014-03-08T13:32:27","id":"97870875","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/yvanvandersanden.jpg","cache":"//a.disquscdn.com/uploads/users/9787/875/avatar32.jpg?1394285549"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/yvanvandersanden.jpg","cache":"//a.disquscdn.com/uploads/users/9787/875/avatar92.jpg?1394285549","large":{"permalink":"http://disqus.com/api/users/avatars/yvanvandersanden.jpg","cache":"//a.disquscdn.com/uploads/users/9787/875/avatar92.jpg?1394285549"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Thanks for sharing this. In visual studio 2013 I'm getting this warning after importing your code:\n\nwarning C4316: 'object allocated on the heap may not be aligned 64' \n\nShould I be worried about that?","createdAt":"2014-03-08T13:32:33","id":"1276399784","thread":"1069844844","depth":0,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Thanks for sharing this. In visual studio 2013 I'm getting this warning after importing your code:\u003c/p>\u003cp>warning C4316: 'object allocated on the heap may not be aligned 64'\u003c/p>\u003cp>Should I be worried about that?\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1276399784,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Hmm, that's a bug! I thought operator new took into account manual alignment, but apparently not. I'll fix it soon.\n\n\nIn the meantime, don't worry about it, because the 64-byte alignment is not actually required (everything will work without it) -- it's just there to try to prevent \"false sharing\" where half the data in one (generally 64-byte) cacheline is being written to by one thread, and half by another thread, causing needless contention even though the data is independent (i.e. it's purely an optimization).\n\n\nThanks for bringing this to my attention :-)","createdAt":"2014-03-08T16:58:40","id":"1276583466","thread":"1069844844","depth":1,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Hmm, that's a bug! I thought operator new took into account manual alignment, but apparently not. I'll fix it soon.\u003c/p>\u003cp>In the meantime, don't worry about it, because the 64-byte alignment is not actually required (everything will work without it) -- it's just there to try to prevent \"false sharing\" where half the data in one (generally 64-byte) cacheline is being written to by one thread, and half by another thread, causing needless contention even though the data is independent (i.e. it's purely an optimization).\u003c/p>\u003cp>Thanks for bringing this to my attention :-)\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1276583466,"isApproved":true,"author":{"username":"yvanvandersanden","about":"","name":"yvan vander sanden","disable3rdPartyTrackers":false,"url":"","isAnonymous":false,"rep":1.233796,"profileUrl":"https://disqus.com/by/yvanvandersanden/","reputation":1.233796,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2014-03-08T13:32:27","id":"97870875","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/yvanvandersanden.jpg","cache":"//a.disquscdn.com/uploads/users/9787/875/avatar32.jpg?1394285549"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/yvanvandersanden.jpg","cache":"//a.disquscdn.com/uploads/users/9787/875/avatar92.jpg?1394285549","large":{"permalink":"http://disqus.com/api/users/avatars/yvanvandersanden.jpg","cache":"//a.disquscdn.com/uploads/users/9787/875/avatar92.jpg?1394285549"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Thanks even more to make such useful code available :-)\n\nfyi, I'm working on a cross-platform 3D sound engine. I've just included your code to enhance the lock free part. Can be found at:\n\nhttps://github.com/yvanvds/yse-soundengine/","createdAt":"2014-03-08T22:25:52","id":"1276955447","thread":"1069844844","depth":2,"numReports":0,"isDeletedByAuthor":false,"likes":1,"isEdited":false,"message":"\u003cp>Thanks even more to make such useful code available :-)\u003c/p>\u003cp>fyi, I'm working on a cross-platform 3D sound engine. I've just included your code to enhance the lock free part. Can be found at:\u003c/p>\u003cp>\u003ca href=\"https://github.com/yvanvds/yse-soundengine/\" rel=\"nofollow\">https://github.com/yvanvds/yse...\u003c/a>\u003c/p>","isSpam":false,"isHighlighted":false,"points":1},{"forum":"moodycamel","parent":1276955447,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"OK, I'm the slowest dev in the universe, but I finally got around to fixing that warning in the trunk :-)","createdAt":"2014-05-20T22:37:06","id":"1396377019","thread":"1069844844","depth":3,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":true,"message":"\u003cp>OK, I'm the slowest dev in the universe, but I finally got around to fixing that warning in the trunk :-)\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1396377019,"isApproved":true,"author":{"name":"zbrown","url":"","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1436308898/images/noavatar32.png","cache":"//a.disquscdn.com/1436308898/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1436308898/images/noavatar92.png","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1436308898/images/noavatar92.png","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png"},"isAnonymous":true},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Are you sure that it was entirely fixed? I am using your latest version from github and still get that warning depending on how I construct the queue.\n\n// this causes no warning\nmoodycamel::ReaderWriterQueue\u003cint> queue;\n\n// using the new keyword still causes the warning\nauto queue = new moodycamel::ReaderWriterQueue\u003cint>;","createdAt":"2014-08-14T17:35:11","id":"1542808420","thread":"1069844844","depth":4,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Are you sure that it was entirely fixed? I am using your latest version from github and still get that warning depending on how I construct the queue.\u003c/p>\u003cp>// this causes no warning\u003cbr>moodycamel::ReaderWriterQueue&lt;int&gt; queue;\u003c/p>\u003cp>// using the new keyword still causes the warning\u003cbr>auto queue = new moodycamel::ReaderWriterQueue&lt;int&gt;;\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1542808420,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Oops, you're right. I had fixed that warning only for the inner Block data structure, not when the queue itself was allocated with `new`. I've pushed a fix :-) Good catch, thanks!","createdAt":"2014-08-14T18:08:22","id":"1542871108","thread":"1069844844","depth":5,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":true,"message":"\u003cp>Oops, you're right. I had fixed that warning only for the inner Block data structure, not when the queue itself was allocated with `new`. I've pushed a fix :-) Good catch, thanks!\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1542871108,"isApproved":true,"author":{"name":"zbrown","url":"","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1436308898/images/noavatar32.png","cache":"//a.disquscdn.com/1436308898/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1436308898/images/noavatar92.png","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1436308898/images/noavatar92.png","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png"},"isAnonymous":true},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Thanks a lot for the fix :D","createdAt":"2014-08-15T02:57:37","id":"1543524922","thread":"1069844844","depth":6,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Thanks a lot for the fix :D\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1396377019,"isApproved":true,"author":{"username":"yvanvandersanden","about":"","name":"yvan vander sanden","disable3rdPartyTrackers":false,"url":"","isAnonymous":false,"rep":1.233796,"profileUrl":"https://disqus.com/by/yvanvandersanden/","reputation":1.233796,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2014-03-08T13:32:27","id":"97870875","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/yvanvandersanden.jpg","cache":"//a.disquscdn.com/uploads/users/9787/875/avatar32.jpg?1394285549"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/yvanvandersanden.jpg","cache":"//a.disquscdn.com/uploads/users/9787/875/avatar92.jpg?1394285549","large":{"permalink":"http://disqus.com/api/users/avatars/yvanvandersanden.jpg","cache":"//a.disquscdn.com/uploads/users/9787/875/avatar92.jpg?1394285549"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Thanks a lot!","createdAt":"2014-05-21T13:48:40","id":"1397223009","thread":"1069844844","depth":4,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Thanks a lot!\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":null,"isApproved":true,"author":{"name":"Anonymous","url":"","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1436308898/images/noavatar32.png","cache":"//a.disquscdn.com/1436308898/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1436308898/images/noavatar92.png","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1436308898/images/noavatar92.png","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png"},"isAnonymous":true},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Have you used this implementation in a real-time audio situation, and if so did it eliminate or minimize the glitches you were experiencing?","createdAt":"2014-02-12T03:07:30","id":"1240609329","thread":"1069844844","depth":0,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Have you used this implementation in a real-time audio situation, and if so did it eliminate or minimize the glitches you were experiencing?\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1240609329,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Well, technically yes, but I haven't worked on that particular project since then past getting a continuous tone to play... But it played without glitches, and was generated real-time on my 1GHz netbook! Mind you, the queue was being used for events, and not the audio data itself... The best way to see if it works for your situation is to try it yourself -- everyone's constraints are different :-)","createdAt":"2014-02-12T14:55:19","id":"1241145865","thread":"1069844844","depth":1,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Well, technically yes, but I haven't worked on that particular project since then past getting a continuous tone to play... But it played without glitches, and was generated real-time on my 1GHz netbook! Mind you, the queue was being used for events, and not the audio data itself... The best way to see if it works for your situation is to try it yourself -- everyone's constraints are different :-)\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":null,"isApproved":true,"author":{"name":"@docchang","url":"","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1436308898/images/noavatar32.png","cache":"//a.disquscdn.com/1436308898/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1436308898/images/noavatar92.png","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1436308898/images/noavatar92.png","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png"},"isAnonymous":true},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Awesome stuff. It would be nice if you could include two more functions T * front() and size_t size().","createdAt":"2013-11-10T17:18:33","id":"1116692499","thread":"1069844844","depth":0,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Awesome stuff. It would be nice if you could include two more functions T * front() and size_t size().\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1116692499,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Thanks :-) How were you thinking of using size() and front() exactly? Would you not also want a dequeue()/pop() which didn't return the element? I'll think about how these methods could be implemented efficiently (and safely!).","createdAt":"2013-11-10T17:54:03","id":"1116756100","thread":"1069844844","depth":1,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Thanks :-) How were you thinking of using size() and front() exactly? Would you not also want a dequeue()/pop() which didn't return the element? I'll think about how these methods could be implemented efficiently (and safely!).\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1116756100,"isApproved":true,"author":{"name":"docchang","url":"","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1436308898/images/noavatar32.png","cache":"//a.disquscdn.com/1436308898/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1436308898/images/noavatar92.png","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1436308898/images/noavatar92.png","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png"},"isAnonymous":true},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Yeah there are times I just want to look at the front of the queue without dequeue. I also trying to implement erase(T & element). How could I safely delete an element and link the previous to the next element?","createdAt":"2013-12-31T09:55:03","id":"1182138779","thread":"1069844844","depth":2,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Yeah there are times I just want to look at the front of the queue without dequeue. I also trying to implement erase(T &amp; element). How could I safely delete an element and link the previous to the next element?\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1182138779,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Good news: I've pushed a new `peek()` method.\n\n\n\nBad news: I'm afraid there's really no safe way to add a \"delete\" operation without impacting the general-case performance of the queue as a whole (higher memory requirements and/or more processing for each element enqueued/dequeued) -- consider the case where the consumer is deleting a node while the producer is adding one; lots of care has to be taken to avoid corrupting the queue in this case. The elements can't simply be shifted over, for instance.\n\n\nHowever, delete can be (safely) simulated on your own side using wrapper objects -- instead of enqueueing elements directly, enqueue a wrapper object that contains the element and a \"deleted\" flag (initially false). Then, simply set the flag when you want to \"delete\" the item, and check the flag as you dequeue the elements.\n\n\nIt sounds like you need a data structure that's more complex than a queue (some sort of lock-free linked list or vector, perhaps); can you elaborate on what larger problem you're trying to solve?","createdAt":"2014-01-01T06:58:48","id":"1183022747","thread":"1069844844","depth":3,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Good news: I've pushed a new `peek()` method.\u003c/p>\u003cp>Bad news: I'm afraid there's really no safe way to add a \"delete\" operation without impacting the general-case performance of the queue as a whole (higher memory requirements and/or more processing for each element enqueued/dequeued) -- consider the case where the consumer is deleting a node while the producer is adding one; lots of care has to be taken to avoid corrupting the queue in this case. The elements can't simply be shifted over, for instance.\u003c/p>\u003cp>However, delete can be (safely) simulated on your own side using wrapper objects -- instead of enqueueing elements directly, enqueue a wrapper object that contains the element and a \"deleted\" flag (initially false). Then, simply set the flag when you want to \"delete\" the item, and check the flag as you dequeue the elements.\u003c/p>\u003cp>It sounds like you need a data structure that's more complex than a queue (some sort of lock-free linked list or vector, perhaps); can you elaborate on what larger problem you're trying to solve?\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":null,"isApproved":true,"author":{"name":"Oli","url":"","profileUrl":"","emailHash":"","avatar":{"small":{"permalink":"//a.disquscdn.com/1436308898/images/noavatar32.png","cache":"//a.disquscdn.com/1436308898/images/noavatar32.png"},"large":{"permalink":"//a.disquscdn.com/1436308898/images/noavatar92.png","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png"},"permalink":"//a.disquscdn.com/1436308898/images/noavatar92.png","cache":"//a.disquscdn.com/1436308898/images/noavatar92.png"},"isAnonymous":true},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Nice article. Would be good to compare performance with boost:spsc_queue too","createdAt":"2013-10-17T00:07:21","id":"1085168004","thread":"1069844844","depth":0,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Nice article. Would be good to compare performance with boost:spsc_queue too\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1085168004,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Thanks! Looking at the source of the boost spsc_queue, it should be roughly comparable to the Folly one (they are both based on fixed-sized ring buffers, which simplifies the logic a little (mine has to handle chained buffers in the worst case)).","createdAt":"2013-10-17T01:37:50","id":"1085248966","thread":"1069844844","depth":1,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Thanks! Looking at the source of the boost spsc_queue, it should be roughly comparable to the Folly one (they are both based on fixed-sized ring buffers, which simplifies the logic a little (mine has to handle chained buffers in the worst case)).\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":null,"isApproved":true,"author":{"username":"thanks_for_an_anon_commentsys","about":"","name":"thanks_for_an_anon_commentsys!","disable3rdPartyTrackers":false,"url":"","isAnonymous":false,"rep":1.232124,"profileUrl":"https://disqus.com/by/thanks_for_an_anon_commentsys/","reputation":1.232124,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2013-08-07T16:56:53","id":"66255026","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/thanks_for_an_anon_commentsys.jpg","cache":"//a.disquscdn.com/uploads/users/6625/5026/avatar32.jpg?1376673375"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/thanks_for_an_anon_commentsys.jpg","cache":"//a.disquscdn.com/uploads/users/6625/5026/avatar92.jpg?1376673375","large":{"permalink":"http://disqus.com/api/users/avatars/thanks_for_an_anon_commentsys.jpg","cache":"//a.disquscdn.com/uploads/users/6625/5026/avatar92.jpg?1376673375"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Great stuff, someday I'd like to try to create a perl wrapper for this...","createdAt":"2013-08-16T17:16:13","id":"1003909541","thread":"1069844844","depth":0,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Great stuff, someday I'd like to try to create a perl wrapper for this...\u003c/p>","isSpam":false,"isHighlighted":false,"points":0},{"forum":"moodycamel","parent":1003909541,"isApproved":true,"author":{"username":"cameron314","about":"","name":"Cameron","disable3rdPartyTrackers":false,"url":"http://moodycamel.com","isAnonymous":false,"rep":1.265628,"profileUrl":"https://disqus.com/by/cameron314/","reputation":1.265628,"location":"","isPrivate":false,"isPrimary":true,"joinedAt":"2011-11-12T05:42:29","id":"18992720","avatar":{"small":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar32.jpg?1321077712"},"isCustom":true,"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712","large":{"permalink":"http://disqus.com/api/users/avatars/cameron314.jpg","cache":"//a.disquscdn.com/uploads/users/1899/2720/avatar92.jpg?1321077712"}}},"media":[],"isDeleted":false,"isFlagged":false,"dislikes":0,"raw_message":"Thanks :-) If you ever do create that wrapper let me know!","createdAt":"2013-08-16T18:02:37","id":"1003957669","thread":"1069844844","depth":1,"numReports":0,"isDeletedByAuthor":false,"likes":0,"isEdited":false,"message":"\u003cp>Thanks :-) If you ever do create that wrapper let me know!\u003c/p>","isSpam":false,"isHighlighted":false,"points":0}],"thread":{"feed":"https://moodycamel.disqus.com/httpmoodycamelcomblog2013a_fast_lock_free_queue_for_c/latest.rss","uploadAdd":"//moodycamel.disqus.com/thread/httpmoodycamelcomblog2013a_fast_lock_free_queue_for_c/async_media_upload/","identifiers":[],"dislikes":0,"likes":4,"message":"","id":"1069844844","isDeleted":false,"category":"1146546","clean_title":"A fast lock-free queue for C","userScore":0,"userSubscription":false,"signedLink":"http://disq.us/?url=http%3A%2F%2Fmoodycamel.com%2Fblog%2F2013%2Fa-fast-lock-free-queue-for-c%2B%2B&key=j6lbofdH6N81qOVRIIGG8g","createdAt":"2013-02-07T06:32:27","hasStreaming":false,"uploadRemove":"//moodycamel.disqus.com/thread/httpmoodycamelcomblog2013a_fast_lock_free_queue_for_c/async_media_remove/","raw_message":"","isClosed":false,"link":"http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++","slug":"httpmoodycamelcomblog2013a_fast_lock_free_queue_for_c","forum":"moodycamel","author":"18992720","posts":49,"moderators":[18992720],"title":"A fast lock-free queue for C++","highlightedPost":null}},"order":"desc"}</script>

    

    <div id="fixed-content"></div>

    <script src="a_data/lounge.js" id="bootstrap-script" data-app="lounge"></script>


<div id="layout" data-tracking-area="layout">

<div id="placement-top" data-tracking-area="discovery-north"></div>
<div id="discovery-top" data-tracking-area="discovery-north"></div>

<div id="onboard" data-tracking-area="onboard"></div>

<div style="display: none;" id="highlighted-post" data-tracking-area="highlighted" class="highlighted-post"></div>

<div id="global-alert"></div>

<header id="main-nav" data-tracking-area="main-nav">
<nav class="nav nav-primary">
<ul>
<li class="tab-conversation active" data-role="post-count">
<a class="publisher-nav-color">
<span class="comment-count">
49 comments
</span>

<span class="comment-count-placeholder">
Comments
</span>
</a>
</li>
<li class="tab-community">
<a href="https://disqus.com/home/forums/moodycamel/" class="publisher-nav-color" data-action="community-sidebar" data-forum="moodycamel" id="community-tab">
<span class="community-name">
<strong>moodycamel.com</strong>

</span>

<strong class="community-name-placeholder">Community</strong>
</a>
</li>
<li class="dropdown user-menu" data-role="logout"><a href="#" class="dropdown-toggle" data-toggle="dropdown">
<span class="dropdown-toggle-wrapper">

<span>
Login
</span>

</span> <span class="caret"></span>
</a>
<ul class="dropdown-menu">


<li>
<a href="#" data-action="auth:disqus">Disqus</a>
</li>
<li>
<a href="#" data-action="auth:facebook">Facebook</a>
</li>
<li>
<a href="#" data-action="auth:twitter">Twitter</a>
</li>
<li>
<a href="#" data-action="auth:google">Google</a>
</li>



</ul>
</li>
<li class="notification-menu unread" data-role="notification-menu"><a href="https://disqus.com/home/inbox/" class="notification-container" data-action="home" data-home-path="home/inbox">
<span class="notification-icon icon-comment" aria-hidden=""></span>
<span class="notification-count" data-role="notification-count">1</span>
</a>
</li>
</ul>
</nav>
</header>

<section id="conversation" data-role="main" data-tracking-area="main">
<div class="nav nav-secondary" data-tracking-area="secondary-nav">
<ul>
<li id="recommend-button" class="recommend dropdown">
<div class="thread-likes"><a href="#" data-action="recommend" title="Recommend this discussion" class="dropdown-toggle ">
<span class="icon-heart"></span>
<span class="label label-default">Recommend</span>
<span class="label label-recommended">Recommended</span>
<span class="label label-count">4</span>
</a>
<ul class="dropdown-menu coachmark">
<li>
<h2>Discussion Recommended!</h2>
<p>Recommending means this is a discussion worth sharing. It gets shared
 to your followers' Disqus feeds, and gives the creator kudos!</p>
<a href="http://disqus.com/home/?utm_source=disqus_embed&amp;utm_content=recommend_btn" class="btn btn-primary" target="_blank">
 Find More Discussions 
</a>
</li>
</ul>
</div></li>
<li id="thread-share-menu" class="dropdown share-menu hidden-sm"><a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Share">
<span class="icon-export"></span>
<span class="label">Share</span>
</a>
<ul class="share-menu dropdown-menu">
<li class="share">Share this discussion on
<ul>
<li class="twitter">
<a data-action="share:twitter" href="#">Twitter</a>
</li>
<li class="facebook">
<a data-action="share:facebook" href="#">Facebook</a>
</li>
</ul>
</li>
</ul>
</li>
<li data-role="post-sort" class="dropdown sorting pull-right">
<a href="#" class="dropdown-toggle" data-toggle="dropdown">

Sort by Newest

<span class="caret"></span>
</a>
<ul class="dropdown-menu pull-right">
<li>
<a href="#" data-action="sort" data-sort="popular">Best<i aria-hidden="true" class="icon-checkmark"></i></a>
</li>

<li class="selected">
<a href="#" data-action="sort" data-sort="desc">Newest<i aria-hidden="true" class="icon-checkmark"></i></a>
</li>

<li>
<a href="#" data-action="sort" data-sort="asc">Oldest<i aria-hidden="true" class="icon-checkmark"></i></a>
</li>
</ul>
</li>
</ul>
</div>

<div id="posts">
<div id="form"><form class="reply">
<div class="postbox">
<div role="alert"></div>
<div class="avatar">
<span class="user">
<img data-role="user-avatar" src="a_data/noavatar92.png" alt="Avatar">
</span>
</div>

<div class="textarea-wrapper" data-role="textarea" dir="auto"><div><span class="placeholder">Join the discussion…</span><div aria-label="Join the discussion…" style="overflow: auto; max-height: 350px;" data-role="editable" aria-multiline="true" role="textbox" tabindex="0" class="textarea" contenteditable="true"><p><br></p></div><div style="display: none;"><ul class="suggestions">
<li class="header">
<h5>in this conversation</h5>
</li>
</ul>
</div></div>
<div data-role="drag-drop-placeholder" class="media-drag-hover" style="display: none">
<div class="drag-text">
⬇ Drag and drop your images here to upload them.
</div>
</div>
<div class="edit-alert" role="postbox-alert"></div>
<div class="post-actions">
<ul class="wysiwyg">
</ul>
</div>
</div>

<div data-role="login-form"><div><section class="auth-section logged-out">
<div class="connect">
<h6>Log in with</h6>
<ul data-role="login-menu" class="services login-buttons">


<li class="auth-disqus">
<button type="button" data-action="auth:disqus" title="Disqus"><i class="icon-disqus"></i></button>
</li>
<li class="auth-facebook">
<button type="button" data-action="auth:facebook" title="Facebook"><i class="icon-facebook-circle"></i></button>
</li>
<li class="auth-twitter">
<button type="button" data-action="auth:twitter" title="Twitter"><i class="icon-twitter-circle"></i></button>
</li>
<li class="auth-google">
<button type="button" data-action="auth:google" title="Google"><i class="icon-google-plus-circle"></i></button>
</li>
</ul>
</div>
<div class="guest">
<h6 class="guest-form-title">
<span class="register-text"> or sign up with Disqus </span>
<span class="guest-text"> or pick a name </span>
</h6>

<div class="what-is-disqus help-icon">
<div id="rules" class="tooltip show">
<h3>Disqus is a discussion network</h3>
<ul>
<li><span>Disqus never moderates or censors. The rules on this community are its own.</span></li>
<li><span>Your email is safe with us. It's only used for moderation and optional notifications.</span></li>
<li><span>Don't be a jerk or do anything illegal. Everything is easier that way.</span></li>
</ul>
<p class="clearfix"><a href="https://docs.disqus.com/kb/terms-and-policies/" class="btn btn-small" target="_blank">Read full terms and conditions</a></p>
</div>
</div>

<p class="input-wrapper">
<input dir="auto" placeholder="Name" name="display_name" id="view131_display_name" maxlength="30" type="text">
</p>

<div class="guest-details " data-role="guest-details">
<p class="input-wrapper">
<input dir="auto" placeholder="Email" name="email" id="view131_email" type="email">
</p>

<p class="input-wrapper">
<input dir="auto" class="register-text" placeholder="Password" name="password" id="view131_password" type="password">
</p>

<div class="acceptance-wrapper register-text">
By signing up, you agree to the Disqus <a target="_blank" href="https://help.disqus.com/customer/portal/articles/1753105-basic-rules-for-disqus-powered-profiles-and-discussions">Basic Rules</a>, <a target="_blank" href="https://help.disqus.com/customer/portal/articles/466260-terms-of-service">Terms of Service</a>, and <a target="_blank" href="https://help.disqus.com/customer/portal/articles/466259-privacy-policy">Privacy Policy</a>.
</div>
<div class="acceptance-wrapper guest-text">
By posting, you agree to the Disqus <a target="_blank" href="https://help.disqus.com/customer/portal/articles/1753105-basic-rules-for-disqus-powered-profiles-and-discussions">Basic Rules</a>, <a target="_blank" href="https://help.disqus.com/customer/portal/articles/466260-terms-of-service">Terms of Service</a>, and <a target="_blank" href="https://help.disqus.com/customer/portal/articles/466259-privacy-policy">Privacy Policy</a>.
</div>

<div class="guest-checkbox">
<label>
<input name="author-guest" type="checkbox">
I'd rather post as guest
</label>
</div>

<div class="proceed" data-role="submit-btn-container">
<button type="submit" class="btn submit" aria-label="Post"><span class="icon-proceed"></span><div class="spinner"></div></button>
<button type="submit" class="btn next" aria-label="Next"><span class="icon-proceed"></span><div class="spinner"></div></button>
</div>
</div>
</div>
</section>

</div></div>
</div>
</form></div>

<button class="alert realtime" style="display: none" data-role="realtime-notification">
</button>

<div id="no-posts" style="display:none"></div>

<ul id="post-list" class="post-list"><li id="post-2044344236" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/Ranshalit/" class="user" data-action="profile" data-username="Ranshalit">
<img data-role="user-avatar" data-user="125214668" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/Ranshalit/" data-action="profile" data-username="Ranshalit" data-role="username">ran</a></span>

</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-2044344236" data-role="relative-time" class="time-ago" title="Monday, May 25, 2015 10:50 AM">
a month ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Hi Cameron,</p><p>I have some question about the usage of std::atomic in the implementation.<br>It is said above "Compiles under MSVC2010+ and GCC 4.7+ (and should work on any C++11 compliant compiler)"<br>But
 I read in other place that "none of the C++11 atomic operations or 
thread support features are supported by Visual C++ 2010.".<br>I probably missunderstand something... Is there explanation for this ?</p><p>Thanks!<br>Ran</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-2044344236">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:2044344236">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-2044473213" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-2044344236" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> ran</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-2044473213" data-role="relative-time" class="time-ago" title="Monday, May 25, 2015 12:15 PM">
a month ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Good catch. Both statements are true! std::atomic is used 
conditionally depending on the compiler. For VS2010, I implemented all 
the equivalent functionality that I use via Microsoft-specific code, 
while for the other compilers I use std::atomic. This is all 
encapsulated in atomicops.h, if you're curious.</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-2044473213">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:2044473213">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"></ul>

</li></ul>

</li><li id="post-2031364368" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/Ranshalit/" class="user" data-action="profile" data-username="Ranshalit">
<img data-role="user-avatar" data-user="125214668" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/Ranshalit/" data-action="profile" data-username="Ranshalit" data-role="username">ran</a></span>

</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-2031364368" data-role="relative-time" class="time-ago" title="Monday, May 18, 2015 2:33 AM">
2 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Hi Cameron,</p><p>I work on video application (video capture , encode
 and streaming) and I think of using both the  single consumer-single 
producer and the multiple consumers queue (encoder for example is the 
only consumer for the capature video, but the encoder output is consumed
 by both filesaving module and network streaming module). Anyhow, I 
would like to ask if you suggest using both implementation (single 
consumer and multiple consumer), each according to the need in design as
 listed above, or will it be easier using only the multiple consumer - 
which seem for me as a better choice in terms of simplicity becuase than
 I'll need to interface with only this API and implementation in both 
cases (the single consumer can be used when using the multiple consumer 
queue too, Right ?).<br>What do you suggest ?</p><p>Thank you!</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-2031364368">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:2031364368">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-2031985618" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-2031364368" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> ran</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-2031985618" data-role="relative-time" class="time-ago" title="Monday, May 18, 2015 11:48 AM">
2 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Yep, I agree that using just one data structure, the 
multi-producer/multi-consumer queue, would be simpler than integrating 
both queues. It should work fine for both use cases (SPSC is a strict 
subset of the generalized MPMC queue problem).</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-2031985618">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:2031985618">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"></ul>

</li></ul>

</li><li id="post-1999042020" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/Ranshalit/" class="user" data-action="profile" data-username="Ranshalit">
<img data-role="user-avatar" data-user="125214668" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/Ranshalit/" data-action="profile" data-username="Ranshalit" data-role="username">ran</a></span>

</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1999042020" data-role="relative-time" class="time-ago" title="Saturday, May 2, 2015 2:55 AM">
2 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Hi Cameron,</p><p>Thank you very much for this valuable information. <br>Can the RWQ be used as fixed size ?</p><p> Thanks,<br> Ran</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1999042020">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1999042020">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1999859541" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1999042020" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> ran</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1999859541" data-role="relative-time" class="time-ago" title="Saturday, May 2, 2015 4:06 PM">
2 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Yes, it can. Simply pass the size to the constructor of the queue, 
and then use `try_enqueue` instead of `enqueue`, which will fail if 
there's not enough room instead of allocating more.</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1999859541">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1999859541">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-2004732098" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/Ranshalit/" class="user" data-action="profile" data-username="Ranshalit">
<img data-role="user-avatar" data-user="125214668" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/Ranshalit/" data-action="profile" data-username="Ranshalit" data-role="username">ran</a></span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1999859541" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Cameron</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-2004732098" data-role="relative-time" class="time-ago" title="Tuesday, May 5, 2015 2:37 AM">
2 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Hi Cameron, <br>If I may please ask another question. I thought of using it with vxWorks on PPC. <br>Is there anything I should take care of ?</p><p>Many Thanks for this public Git,<br>Ran</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-2004732098">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:2004732098">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-2005375294" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-2004732098" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> ran</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-2005375294" data-role="relative-time" class="time-ago" title="Tuesday, May 5, 2015 7:20 AM">
2 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Of course you may ask :-)</p><p>In theory, the queue should work 
properly out-of-the-box on any platform, since it reverts to standard 
C++11 primitives on non-special-cased compilers.</p><p>However, I have 
never tested it with vxWorks, nor on PowerPC. So I'd love to hear how it
 goes if you do try it! If you come across any incompatibilities (or 
bugs!), please simply open a GitHub issue and I'll see what I can do to 
fix them.</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-2005375294">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:2005375294">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"></ul>

</li></ul>

</li></ul>

</li></ul>

</li><li id="post-1778254375" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/virgoptrex/" class="user" data-action="profile" data-username="virgoptrex">
<img data-role="user-avatar" data-user="36730387" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/virgoptrex/" data-action="profile" data-username="virgoptrex" data-role="username">virgoptrex</a></span>

</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1778254375" data-role="relative-time" class="time-ago" title="Thursday, January 8, 2015 8:51 AM">
6 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>I conducted some further tests and found an interesting tidbit in my 
C++ code. I used two pthreads (one reader and  one writer) to transfer 
some data with the lock free queue object declared global. When I run 
both pthreads and there is *NO* millisleep function in writer thread 
between each write (or reader thread), everything works fine! I am able 
to read data correctly in the reader thread. Then I introduce a 
millisleep 100 ms in writer thread between each writes and the reader is
 NOT able to read the data anymore. Any idea why? Have you conducted 
such a test? I would think declaring global queue should not be a 
problem (it is extern but should not be a problem).</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1778254375">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1778254375">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1778392439" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1778254375" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> virgoptrex</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1778392439" data-role="relative-time" class="time-ago" title="Thursday, January 8, 2015 10:26 AM">
6 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>This sounds like a concurrency bug in my queue. (I, too, doubt it's related to it being global.)<br>I'd really appreciate it if you could <a href="https://github.com/cameron314/readerwriterqueue/issues" rel="nofollow">open an issue on github</a> for this with a compilable test case.</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1778392439">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1778392439">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1780039807" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/virgoptrex/" class="user" data-action="profile" data-username="virgoptrex">
<img data-role="user-avatar" data-user="36730387" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/virgoptrex/" data-action="profile" data-username="virgoptrex" data-role="username">virgoptrex</a></span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1778392439" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Cameron</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1780039807" data-role="relative-time" class="time-ago" title="Thursday, January 8, 2015 5:53 PM">
6 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div style="height: 374px;" class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>I will do that later once I am home, I have to sign up for github. 
but in the meantime run the following code by changing _DELAY_ macro to 0
 or 1. No delay behaviour seems odd. Disqus screwed my indentation so 
use some program like 'astyle' to get it back.</p><p>//===================== code starts below ========================</p><p>//Quick and dirty test by virgoptrex for Cameron's MoodyCamel Lock Free Queue<br>//compile using: g++ -g <a href="http://pthread_test.cc/" rel="nofollow">pthread_test.cc</a> -o pthread_test -lpthread -std=c++0x</p><p>//Change _DELAY_ value to 1 and 0 to toggle between delay and no delay</p><p>#define __STDC_FORMAT_MACROS<br>#include &lt;inttypes.h&gt;<br>#include &lt;pthread.h&gt;<br>#include &lt;stdio.h&gt;<br>#include &lt;stdlib.h&gt;<br>#include &lt;stdint.h&gt;<br>#include "readerwriterqueue.h"</p><p>#ifndef _DELAY_<br>#define _DELAY_ 1<br>#endif</p><p>moodycamel::ReaderWriterQueue&lt;uint64_t&gt; queue;</p><p>void milliseconds_delay(uint32_t milisec)<br>{<br>struct timespec req = {0};<br>req.tv_sec = 0;<br>req.tv_nsec = milisec * 1000000L;<br>nanosleep(&amp;req, (struct timespec *)NULL);<br>}</p><p>void *Writer(void *threadid)<br>{<br>   long tid;<br>   uint64_t counter = 0;<br>   tid = (long)threadid;<br>   printf("Hello World! It's me, thread #%ld!\n", tid);<br>   while(1){<br>     queue.try_enqueue(counter++);<br>     printf("sent uint64_t : %" PRIu64 "\n", counter);<br>#if _DELAY_<br>     milliseconds_delay(100);<br>#endif<br>   }<br>   pthread_exit(NULL);<br>}</p><p>void *Reader(void *threadid)<br>{<br>   long tid;<br>   tid = (long)threadid;<br>   printf("Hello World! It's me, thread #%ld!\n", tid);<br>   while(1){<br>     uint64_t value;<br>     queue.try_dequeue(value);<br>     printf("received uint64_t : %" PRIu64 "\n", value);<br>#if _DELAY_<br>     milliseconds_delay(100);<br>#endif<br>   }<br>   pthread_exit(NULL);<br>}</p><p>int main (int argc, char *argv[])<br>{<br>   pthread_t reader_thread;<br>   pthread_t writer_thread;<br>   int rc;<br>   long t;<br>      printf("In main: creating reader thread %ld\n", t);<br>      rc = pthread_create(&amp;reader_thread, NULL, Reader, (void *)0);<br>      if (rc){<br>         printf("ERROR; return code from reader pthread_create() is %d\n", rc);<br>         exit(-1);<br>      }<br>      printf("In main: creating thread %ld\n", t);<br>      rc = pthread_create(&amp;writer_thread, NULL, Writer, (void *)1);<br>      if (rc){<br>         printf("ERROR; return code from writer pthread_create() is %d\n", rc);<br>         exit(-1);<br>      }</p><p>   /* Last thing that main() should do */<br>   pthread_exit(NULL);<br>}</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1780039807">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1780039807">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1780158342" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1780039807" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> virgoptrex</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1780158342" data-role="relative-time" class="time-ago" title="Thursday, January 8, 2015 6:13 PM">
6 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Thanks for the test case! That's awesome. I'll look into as soon as I
 can (I'm presently at work). I'd still appreciate a GitHub issue, as 
Disqus seems to have eaten all the formatting. Also, maybe I'm 
misreading something, but isn't Reader doing the writing and Writer 
doing the reading?</p><p>Oh, and what's your version of g++?</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-1" data-action="upvote" title="">

<span class="updatable count" data-role="likes">1</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1780158342">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1780158342">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1781351166" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/virgoptrex/" class="user" data-action="profile" data-username="virgoptrex">
<img data-role="user-avatar" data-user="36730387" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/virgoptrex/" data-action="profile" data-username="virgoptrex" data-role="username">virgoptrex</a></span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1780158342" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Cameron</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1781351166" data-role="relative-time" class="time-ago" title="Thursday, January 8, 2015 10:18 PM">
6 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>oh yes you are right. my bad in naming functions. updated names.<br> g++ --version<br>g++ (Ubuntu/Linaro 4.7.3-2ubuntu1~12.04) 4.7.3<br>Copyright (C) 2012 Free Software Foundation, Inc.<br>This is free software; see the source for copying conditions.  There is NO<br>warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.<br>I updated issue on github.</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1781351166">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1781351166">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1999046561" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/Ranshalit/" class="user" data-action="profile" data-username="Ranshalit">
<img data-role="user-avatar" data-user="125214668" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/Ranshalit/" data-action="profile" data-username="Ranshalit" data-role="username">ran</a></span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1781351166" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> virgoptrex</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1999046561" data-role="relative-time" class="time-ago" title="Saturday, May 2, 2015 3:03 AM">
2 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Hi,<br>Is this issue been resolved ?<br>Thanks,<br>Ran</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1999046561">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1999046561">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"></ul>

</li></ul>

</li></ul>

</li></ul>

</li></ul>

</li></ul>

</li><li id="post-1689697972" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/disqus_VJXz5gq0Ai/" class="user" data-action="profile" data-username="disqus_VJXz5gq0Ai">
<img data-role="user-avatar" data-user="60814317" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_VJXz5gq0Ai/" data-action="profile" data-username="disqus_VJXz5gq0Ai" data-role="username">Dima</a></span>

</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1689697972" data-role="relative-time" class="time-ago" title="Wednesday, November 12, 2014 11:05 AM">
8 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>I tested on different Xeon CPUs and winners are SPSC or Folly:</p><p>Xeon(R) CPU           X5675  @ 3.07GHz</p><p>Average ops/s:<br>    ReaderWriterQueue: 198.75 million<br>    SPSC queue:        216.68 million<br>    Folly queue:       247.67 million</p><p>Intel(R) Xeon(R) CPU E5-2650 0 @ 2.00GHz</p><p>Average ops/s:<br>    ReaderWriterQueue: 182.79 million<br>    SPSC queue:        256.72 million <br>Folly queue:       248.20 million</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1689697972">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1689697972">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1689715386" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1689697972" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Dima</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1689715386" data-role="relative-time" class="time-ago" title="Wednesday, November 12, 2014 11:16 AM">
8 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Interesting. Thanks for the results. What compiler did you use?</p><p>Folly's
 queue was always a bit faster than mine, because it's fixed-size, 
whereas mine has to deal with the (slight) overhead of potentially 
multiple linked blocks (this is to support dynamic resizing).</p><p>What
 surprises me is the huge jump in performance of the SPSC queue; 
radically different than in my tests! How much of that is attributable 
to the dequeue-from-empty case, I wonder?</p><p>Anyway, use whichever 
one is fastest for your circumstances and has the features you need. If 
you don't need dynamic resizing, go for Folly's. If you don't need to 
allocate memory upfront, use Dmitry's SPSC queue (if it's faster on your
 platform). Otherwise, use mine :-)</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1689715386">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1689715386">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"></ul>

</li></ul>

</li><li id="post-1561492876" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/virgoptrex/" class="user" data-action="profile" data-username="virgoptrex">
<img data-role="user-avatar" data-user="36730387" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/virgoptrex/" data-action="profile" data-username="virgoptrex" data-role="username">virgoptrex</a></span>

</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1561492876" data-role="relative-time" class="time-ago" title="Wednesday, August 27, 2014 8:31 AM">
10 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>case memory_order_relaxed: break;</p><p>		case memory_order_acquire: std::atomic_thread_fence(std::memory_order_acquire); break;</p><p>		case memory_order_release: std::atomic_thread_fence(std::memory_order_release); break;</p><p>		case memory_order_acq_rel: std::atomic_thread_fence(std::memory_order_acq_rel); break;</p><p>		case memory_order_seq_cst: std::atomic_thread_fence(std::memory_order_seq_cst); break;</p><p>does
 not work on &lt; gcc 4.7 . apparently this is a bug in gcc older 
versions and needs to be replace by sync_synchronize() or __asm__ 
__volatile__ ( "mfence" ::: "memory")</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1561492876">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1561492876">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1561674790" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1561492876" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> virgoptrex</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1561674790" data-role="relative-time" class="time-ago" title="Wednesday, August 27, 2014 10:50 AM">
10 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Do you mean std::atomic_signal_fence doesn't work in GCC &lt; 4.7? Do you have a link to the bug report?</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1561674790">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1561674790">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1566661987" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/virgoptrex/" class="user" data-action="profile" data-username="virgoptrex">
<img data-role="user-avatar" data-user="36730387" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/virgoptrex/" data-action="profile" data-username="virgoptrex" data-role="username">virgoptrex</a></span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1561674790" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Cameron</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1566661987" data-role="relative-time" class="time-ago" title="Saturday, August 30, 2014 3:38 PM">
10 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Cameron I meant to state atomic_thread_fence not atomic_signal_fence -
 Apologize for confusion. I have updated my post accordingly. Yes it 
does not seem to work in GCC &lt; 4.7. I upgraded from GCC 4.6 to 4.7 
and it worked fine. See this for bug report <a href="http://stackoverflow.com/questions/16429669/stdatomic-thread-fence-has-undefined-reference" rel="nofollow">http://stackoverflow.com/quest...</a></p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1566661987">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1566661987">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1569291472" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1566661987" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> virgoptrex</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1569291472" data-role="relative-time" class="time-ago" title="Monday, September 1, 2014 3:34 PM">
10 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Aha, I see. Thanks for letting me know! Pesky compiler bugs.</p><p>Do
 you think there's many people stuck on GCC 4.6? I could add a 
special-case #if directive to fix this by using a full-fence 
__sync_synchronize instead, but it wouldn't be as fast as the normal 
atomic_thread_fences since I don't use any full fences in the fast path 
(the acquire and release fences I use boil down to no-ops on x86, for 
example).</p><p>On a side note, I was about to update the README but I 
realized it already lists GCC 4.7+ as the minimum supported version ;-) 
(By chance, not because I knew about the bug.)</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1569291472">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1569291472">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1571156791" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/virgoptrex/" class="user" data-action="profile" data-username="virgoptrex">
<img data-role="user-avatar" data-user="36730387" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/virgoptrex/" data-action="profile" data-username="virgoptrex" data-role="username">virgoptrex</a></span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1569291472" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Cameron</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1571156791" data-role="relative-time" class="time-ago" title="Tuesday, September 2, 2014 7:25 PM">
10 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Well. Anyone who has updated build tools i.e. post 2013 shouldn't 
have any issues. I was using Ubuntu 12.04 LTS, that has my tool chain 
already setup, which ships with 4.6 GCC. I had no issues updating the 
GCCs to 4.7 on Ubuntu for both native X86 and ARM cross compile build. 
However, I am not sure if that is the case with other Linux Distros. You
 could though state this BUG or provide some reference in README file 
even if you choose to not update the code. Having said that though, it 
shouldn't be too hard to update GCC IMAO.</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1571156791">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1571156791">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1571336762" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1571156791" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> virgoptrex</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1571336762" data-role="relative-time" class="time-ago" title="Tuesday, September 2, 2014 10:13 PM">
10 months ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Alright. Thanks for the tips, I don't use Linux very much (just my 
server's on Fedora, which coincidentally I remember upgrading a while 
back to get g++ 4.9 for some other features). I'll emphasize in the 
README that there's a bug in g++ 4.6 that prevents the code from working
 properly.</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1571336762">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1571336762">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"></ul>

</li></ul>

</li></ul>

</li></ul>

</li></ul>

</li></ul>

</li><li id="post-1380760115" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/myclassescom/" class="user" data-action="profile" data-username="myclassescom">
<img data-role="user-avatar" data-user="100248911" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/myclassescom/" data-action="profile" data-username="myclassescom" data-role="username">My-Classes.com</a></span>

</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1380760115" data-role="relative-time" class="time-ago" title="Monday, May 12, 2014 6:19 AM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Very interesting work. The performance comparison looks great. Few follow-up questions,</p><p>1.
 Wondering what would it take to convert this into 'multiple producer 
and multiple consumer' scenario, or at-least single producer, multiple 
consumer.</p><p>2. What would be your suggestion to make this 'event 
oriented'. Lets say, the queue has certain 'observer(s)' who would be 
interested in getting notified (callback) about the availability of an 
item in the queue.</p><p>The reason for the second option is: even 
though the data-structure is very fast, in real world, one would need a 
dedicated thread to 'poll' over the queue (e.g. the consumer has to keep
 asking 'you got something for me'), which degraded overall system 
performance. If event system (such as libsigc++) can be combined with 
this, it would be very useful for real-world scenarios. If you could 
throw some pointers, we would be happy to integrate this queue with 
event system. Appreciate any pointers.</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-1" data-action="upvote" title="">

<span class="updatable count" data-role="likes">1</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1380760115">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1380760115">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1381323417" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1380760115" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> My-Classes.com</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1381323417" data-role="relative-time" class="time-ago" title="Monday, May 12, 2014 2:16 PM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Hi :-)</p><p>1. Nope, not possible. The design is fundamentally 
limited to a single producer and consumer. Having said that, I'm working
 on a full multiple-consumer, multiple-producer queue (I need to write 
some more tests and documentation, but the queue itself is pretty much 
done). Stay tuned!</p><p>2. Hmm, interesting. This would use OS-level 
events to provide fast low-overhead blocking behaviour? I'm not sure I 
like the callback part, as the callback would necessarily be on the 
producer thread, and if you dequeued within the callback, no other 
thread would ever be able to dequeue simultaneously -- which brings you 
right back to a single-threaded queue, in which case you don't need 
anything to be lock-free and you can use a faster thread-oblivious 
queue. But a low-overhead blocking model would be interesting (the cost 
of the extra polling thread would be low if it's just waiting on an OS 
handle most of the time).</p><p>You can implement your own blocking 
queue on top of mine fairly easily, without having to modify any of the 
code -- simply wrap it inside another class that provides equivalent 
enqueue/dequeue functionality, except that *after* any enqueue operation
 completes, it increments a semaphore. Then you can add a 'dequeue_wait'
 method that blocks on the semaphore (and a regular 'try_dequeue' 
method, if needed, that also decrements the semaphore after an item is 
successfully removed). This is similar to how the .NET framework 
implements its BlockingCollection&lt;T&gt; class, by the way.</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1381323417">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1381323417">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1384406863" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/myclassescom/" class="user" data-action="profile" data-username="myclassescom">
<img data-role="user-avatar" data-user="100248911" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/myclassescom/" data-action="profile" data-username="myclassescom" data-role="username">My-Classes.com</a></span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1381323417" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Cameron</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1384406863" data-role="relative-time" class="time-ago" title="Wednesday, May 14, 2014 8:20 AM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Thank you. Will wait for MPMC queue. Your work will surely help many.
 And thank you for the pointers. Will try to experiment on adding events
 to the queue.</p><p>Just one quick question: It might be obvious, but 
just to want to confirm: the performance comparison in the article 
showcases performance across similar lock-free implementation, and yours
 is better. But, does this also imply this lock-free implementation 
performs better than any other existing locked (e.g. mutexes)  versions?
 Do you happen to have any rough study that indicates the speed-up 
factor against the locked implementations (to convince the 
non-believers)?</p><p>The reason is: we recently came across few 
libraries that use 'memory barriers' to achieve parallelism - but the 
cost of 'memory barrier' is so high that it is utterly unusable for 
practical problems -  a simple spinlock / CS could have given far better
 performance. Hope that is not the case here.</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1384406863">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1384406863">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1384542216" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1384406863" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> My-Classes.com</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1384542216" data-role="relative-time" class="time-ago" title="Wednesday, May 14, 2014 9:49 AM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div style="height: 374px;" class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Right, so, my queue is not always the fastest, actually -- the folly 
one is faster -- though the folly queue is fixed-size while mine is can 
expand dynamically (and this difference is the fundamental reason for 
the performance difference).</p><p>I haven't benchmarked a lock-based 
queue, but the benefits that a lock-based design give (not having to 
worry about other threads executing) would be minuscule in this case, 
since the overhead of my design compared to a single-threaded one is 
very low (the hoops I jump through to achieve safe lock-free 
synchronization are minimal in terms of implementation complexity, even 
if the underlying algorithms are more involved than their non-threaded 
cousins). The overhead of a mutex-based version would be higher than 
what I do now, since I do almost no synchronization (at least, not any 
explicit synchronization). The producer and consumer threads are 
more-or-less independent, looking only at a bit of each other's data 
here and there to see if there's any elements to dequeue or enough room 
to enqueue.</p><p>The entire reason I wrote this queue was because I 
wanted to avoid the overhead of a lock-based one :-) It's designed to be
 highly efficient under heavy contention, whereas a lock-based version 
would be alright under low contention, and very slow (comparatively) 
under high contention.</p><p>Benchmarking a lock/mutex/CS based version 
would be interesting, but it depends heavily on the implementation of 
the lock (with the fastest versions generally being supplied by the OS).
 For example, I do in fact have a benchmark of such a queue for my MPMC 
queue project, and the implementation of std::mutex on MinGW (on 
Windows) is so poor that it regularly performs 100-1000x worse than any 
of the other lock-free queues I compare it to. But the same code on 
Linux usually has a speed difference within an order of magnitude 
(though still slower (sometimes *much* slower) on average).</p><p>As for
 memory barriers, my queue uses them all over the place! It is 
impossible to write a correct lock-free queue without them. I'm not sure
 why you think memory barriers are expensive (I suppose it depends on 
the barrier and on the hardware, but the two most common barriers, 
'acquire' and 'release' are no-ops on the most common processor, x86).</p><p>I hope my rambling helps answer your questions? ;-)</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1384542216">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1384542216">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1386381375" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/myclassescom/" class="user" data-action="profile" data-username="myclassescom">
<img data-role="user-avatar" data-user="100248911" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/myclassescom/" data-action="profile" data-username="myclassescom" data-role="username">My-Classes.com</a></span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1384542216" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Cameron</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1386381375" data-role="relative-time" class="time-ago" title="Wednesday, May 14, 2014 10:44 PM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div style="height: 374px;" class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Thank you for the detailed answer Cameron. Yes, it clarified the differences.</p><p>Memory
 barriers, perhaps as you said, depend again on the OS or particular 
implementation. Recently we were benchmarking the standard 'ThreadRing' 
problem on one of the parallel libraries which uses lock-free queues. In
 this particular case the challenge is to create 503 creates and send a 
token around in a loop across the threads. What we observed was all the 
503 threads had to spend at least few seconds (about 5 to 10 seconds) 
just to get across the memory barrier on Windows (did not check it on 
Linux variants).</p><p>Perhaps its the high thread count (503) that 
caused the delay with the barrier. If that is the case, then SPSC queues
 may not have this problem since they expect one or two threads to 
access it at any point of time. However, for MPMC , since it involves 
multiple threads using the barriers, it might be affected by this 
problem (not sure). (Here is the original challenge: <a href="http://benchmarksgame.alioth.debian.org/u32/performance.php?test=threadring" rel="nofollow">http://benchmarksgame.alioth.d...</a> )</p><p>On
 this MPMC I have a follow-up question: we have this real world scenario
 where we are looking for a good design, and hence benchmarking the 
parallel libraries - but couldn't come close to any - perhaps you could 
throw some light.</p><p>Let us say, we have multiple producers that have to distribute work items to multiple consumers. The challenge is:<br>1. We should achieve maximum throughput and performance under heavy load<br>2. under no load, the system cpu-usage and resource usage should be near zero<br>Can MPMC solve this problem, especially the second part?</p><p>I
 know, under heavy load, the work-hungry consumers can keep dequeuing 
the items from MPMC as fast as they can in a loop inside a thread. But 
under no load, what does each of those consumers do? Just busy wait?? 
(since there is no lock primitive and nothing to consume)</p><p>What is your view on how to solve this zero-work under zero-load for MPMC?</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1386381375">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1386381375">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1395585051" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1386381375" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> My-Classes.com</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1395585051" data-role="relative-time" class="time-ago" title="Tuesday, May 20, 2014 9:38 AM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div style="height: 374px;" class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Hmm, 503 threads sounds like an awful lot for a machine with &lt;100 
cores. You'd need to get help from the OS to have any hope of it being 
fast at all (e.g. by using blocking OS primitives like semaphores or 
events). I know that on Windows, just <em>creating</em> 503 threads 
could take a while. In practice, you'd never want that many threads 
active at once (there's a reason that thread pools are popular). At that
 point, you're adding significant overhead for zero benefit.</p><p>Memory
 barriers are lower-level than the OS, actually -- they're implemented 
directly in hardware (different instructions have different memory 
barrier semantics, and the memory barriers expressed in, say, C++, cause
 the compiler to select different instructions). On x86, for example, 
all loads have acquire semantics, and all stores have release semantics 
(so acquire and release are no-ops on x86, but still have to be written 
in the code to avoid the compiler re-ordering instructions -- and for 
portability). Some atomic instructions (with the 'lock' prefix) have 
stronger guarantees, I believe, and a full fence has a dedicated 
instruction ('mfence').</p><p>Actually, how do you know the time taken is being lost to memory barriers? How are you measuring this?</p><p>If
 you want maximum throughput (as most lock-free queues are designed 
for), then polling is the way to go. This is because busy-waiting has 
lower latency than telling the OS to put your thread to sleep (or block 
on a semaphore, say) and then waking it up later, since the time between
 incoming elements is in the sub-microsecond range.</p><p>If you don't 
have that high rate of incoming elements (and processing them generally 
eclipses the overhead of the queue itself, by the way), then by 
definition you don't have a high-throughput situation. In that case, you
 can trade some latency (and total throughput capacity) for lower 
overhead in the dry spells; one way to do this, as I mentioned, would be
 to use an OS semaphore to track the number of elements in the queue, 
and block on the semaphore before dequeueing. Since you want to also 
scale to high-throughput, then you could busy-wait poll for, say, half a
 millisecond before blocking the thread on the semaphore (this would 
improve the latency, but you'd still have to pay the overhead of 
managing the semaphore). This is what I would do in such a situation. 
Unfortunately, there's no way to avoid <em>some</em> extra overhead to 
reduce busy-waiting, because it is not something that can be done 
without cooperation with the OS (even if you're working with a thread 
pool and there are other tasks that can be done while the threads are 
waiting, thus avoiding actual blocking/sleeping, it's the same overhead 
except that the implementation is in userland instead of the OS).</p><p>I'm
 curious -- what real-world scenario requires a high-throughput 
multithreaded queue but has traffic so bursty that the dry spells are 
long enough to warrant sleeping the threads?</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1395585051">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1395585051">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"></ul>

</li></ul>

</li></ul>

</li></ul>

</li></ul>

</li></ul>

</li><li id="post-1326968763" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/artemsaveliev/" class="user" data-action="profile" data-username="artemsaveliev">
<img data-role="user-avatar" data-user="102447862" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/artemsaveliev/" data-action="profile" data-username="artemsaveliev" data-role="username">Artem Saveliev</a></span>

</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1326968763" data-role="relative-time" class="time-ago" title="Wednesday, April 9, 2014 2:56 PM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>I was trying to understand how lock-free is actually achieved - 
people rarely explain that this is still a lock but in hardware. So it's
 a great summary! I just wanted to confirm that even with better ram 
model, we will still have locks, but explicit in hardware - not in this 
hacked cache coherence way.</p><p>Have you looked at how Intel TSX works, and would that (at least conceptually) help?</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1326968763">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1326968763">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1327089412" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1326968763" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Artem Saveliev</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1327089412" data-role="relative-time" class="time-ago" title="Wednesday, April 9, 2014 3:50 PM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Actually, it's not really a lock in a cache coherency model -- the 
hardware ensures atomicity, but not mutual exclusion. If it was a proper
 lock, then deadlocks could occur, and threads interrupting each other 
could cause priority inversion. I'm not sure where the future of 
hardware is going, but apparently Intel and others claims the 
cache-coherency model can scale even with many CPU cores (I think this 
is because memory bandwidth remains the real bottleneck).</p><p>Unfortunately, I haven't looked into transactional memory, so I can't comment on TSX.</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1327089412">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1327089412">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1329264413" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/artemsaveliev/" class="user" data-action="profile" data-username="artemsaveliev">
<img data-role="user-avatar" data-user="102447862" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/artemsaveliev/" data-action="profile" data-username="artemsaveliev" data-role="username">Artem Saveliev</a></span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1327089412" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Cameron</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1329264413" data-role="relative-time" class="time-ago" title="Thursday, April 10, 2014 11:05 AM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Yes, I understand that there's no transactions here - but it's a 
hardware-assisted way to write lock-free code. It was just hard to 
understand this bit - people keep mentioning compare-and-swap as primary
 way to implement lock-free code, but on the surface (in C 
implementation) it doesn't look like it's thread-safe, until you 
understand that two lines (compare, swap) convert into one in asm (i.e. 
cmpxchg16b)</p><p>It looks like memory fetching still trumps cache 
synchronization by 100x or more. So in real applications, that don't 
just deal with cached data, it is not a major factor. Well, until we get
 100 cores that is :)</p><p>The interesting thing about TSX, in the 
version that's called "Restricted Transactional Memory" is that it does 
indeed have transaction failure and fallback mechanism that can be set 
up by the developer. What's annoying is that Intel is not describing how
 it works internally, so people actually have to research it as a black 
box...</p><p>According to wiki, they may be changing how it works under 
the hood in couple of generations, that's when we should be approaching 
the tens of cores.</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1329264413">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1329264413">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"></ul>

</li></ul>

</li></ul>

</li><li id="post-1276399784" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/yvanvandersanden/" class="user" data-action="profile" data-username="yvanvandersanden">
<img data-role="user-avatar" data-user="97870875" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/yvanvandersanden/" data-action="profile" data-username="yvanvandersanden" data-role="username">yvan vander sanden</a></span>

</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1276399784" data-role="relative-time" class="time-ago" title="Saturday, March 8, 2014 8:32 AM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Thanks for sharing this. In visual studio 2013 I'm getting this warning after importing your code:</p><p>warning C4316: 'object allocated on the heap may not be aligned 64'</p><p>Should I be worried about that?</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1276399784">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1276399784">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1276583466" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1276399784" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> yvan vander sanden</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1276583466" data-role="relative-time" class="time-ago" title="Saturday, March 8, 2014 11:58 AM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Hmm, that's a bug! I thought operator new took into account manual alignment, but apparently not. I'll fix it soon.</p><p>In
 the meantime, don't worry about it, because the 64-byte alignment is 
not actually required (everything will work without it) -- it's just 
there to try to prevent "false sharing" where half the data in one 
(generally 64-byte) cacheline is being written to by one thread, and 
half by another thread, causing needless contention even though the data
 is independent (i.e. it's purely an optimization).</p><p>Thanks for bringing this to my attention :-)</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1276583466">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1276583466">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1276955447" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/yvanvandersanden/" class="user" data-action="profile" data-username="yvanvandersanden">
<img data-role="user-avatar" data-user="97870875" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/yvanvandersanden/" data-action="profile" data-username="yvanvandersanden" data-role="username">yvan vander sanden</a></span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1276583466" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Cameron</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1276955447" data-role="relative-time" class="time-ago" title="Saturday, March 8, 2014 5:25 PM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Thanks even more to make such useful code available :-)</p><p>fyi, 
I'm working on a cross-platform 3D sound engine. I've just included your
 code to enhance the lock free part. Can be found at:</p><p><a href="https://github.com/yvanvds/yse-soundengine/" rel="nofollow">https://github.com/yvanvds/yse...</a></p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-1" data-action="upvote" title="">

<span class="updatable count" data-role="likes">1</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1276955447">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1276955447">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1396377019" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1276955447" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> yvan vander sanden</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1396377019" data-role="relative-time" class="time-ago" title="Tuesday, May 20, 2014 6:37 PM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>OK, I'm the slowest dev in the universe, but I finally got around to fixing that warning in the trunk :-)</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1396377019">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1396377019">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1542808420" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar">
<div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div>
</div>

<div class="post-body">
<header>
<span class="post-byline">
<span class="author">zbrown</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1396377019" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Cameron</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1542808420" data-role="relative-time" class="time-ago" title="Thursday, August 14, 2014 1:35 PM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Are you sure that it was entirely fixed? I am using your latest 
version from github and still get that warning depending on how I 
construct the queue.</p><p>// this causes no warning<br>moodycamel::ReaderWriterQueue&lt;int&gt; queue;</p><p>// using the new keyword still causes the warning<br>auto queue = new moodycamel::ReaderWriterQueue&lt;int&gt;;</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1542808420">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1542808420">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1542871108" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1542808420" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> zbrown</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1542871108" data-role="relative-time" class="time-ago" title="Thursday, August 14, 2014 2:08 PM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Oops, you're right. I had fixed that warning only for the inner Block
 data structure, not when the queue itself was allocated with `new`. 
I've pushed a fix :-) Good catch, thanks!</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1542871108">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1542871108">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1543524922" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar">
<div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div>
</div>

<div class="post-body">
<header>
<span class="post-byline">
<span class="author">zbrown</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1542871108" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Cameron</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1543524922" data-role="relative-time" class="time-ago" title="Thursday, August 14, 2014 10:57 PM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Thanks a lot for the fix :D</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1543524922">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1543524922">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"></ul>

</li></ul>

</li></ul>

</li><li id="post-1397223009" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/yvanvandersanden/" class="user" data-action="profile" data-username="yvanvandersanden">
<img data-role="user-avatar" data-user="97870875" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/yvanvandersanden/" data-action="profile" data-username="yvanvandersanden" data-role="username">yvan vander sanden</a></span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1396377019" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Cameron</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1397223009" data-role="relative-time" class="time-ago" title="Wednesday, May 21, 2014 9:48 AM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Thanks a lot!</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1397223009">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1397223009">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"></ul>

</li></ul>

</li></ul>

</li></ul>

</li></ul>

</li><li id="post-1240609329" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar">
<div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div>
</div>

<div class="post-body">
<header>
<span class="post-byline">
<span class="author">Anonymous</span>

</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1240609329" data-role="relative-time" class="time-ago" title="Tuesday, February 11, 2014 10:07 PM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Have you used this implementation in a real-time audio situation, and
 if so did it eliminate or minimize the glitches you were experiencing?</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1240609329">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1240609329">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1241145865" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1240609329" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Anonymous</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1241145865" data-role="relative-time" class="time-ago" title="Wednesday, February 12, 2014 9:55 AM">
a year ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Well, technically yes, but I haven't worked on that particular 
project since then past getting a continuous tone to play... But it 
played without glitches, and was generated real-time on my 1GHz netbook!
 Mind you, the queue was being used for events, and not the audio data 
itself... The best way to see if it works for your situation is to try 
it yourself -- everyone's constraints are different :-)</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1241145865">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1241145865">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"></ul>

</li></ul>

</li><li id="post-1116692499" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar">
<div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div>
</div>

<div class="post-body">
<header>
<span class="post-byline">
<span class="author">@docchang</span>

</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1116692499" data-role="relative-time" class="time-ago" title="Sunday, November 10, 2013 12:18 PM">
2 years ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Awesome stuff. It would be nice if you could include two more functions T * front() and size_t size().</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1116692499">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1116692499">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1116756100" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1116692499" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> @docchang</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1116756100" data-role="relative-time" class="time-ago" title="Sunday, November 10, 2013 12:54 PM">
2 years ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Thanks :-) How were you thinking of using size() and front() exactly?
 Would you not also want a dequeue()/pop() which didn't return the 
element? I'll think about how these methods could be implemented 
efficiently (and safely!).</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1116756100">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1116756100">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1182138779" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar">
<div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div>
</div>

<div class="post-body">
<header>
<span class="post-byline">
<span class="author">docchang</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1116756100" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Cameron</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1182138779" data-role="relative-time" class="time-ago" title="Tuesday, December 31, 2013 4:55 AM">
2 years ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Yeah there are times I just want to look at the front of the queue 
without dequeue. I also trying to implement erase(T &amp; element). How 
could I safely delete an element and link the previous to the next 
element?</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1182138779">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1182138779">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1183022747" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1182138779" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> docchang</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1183022747" data-role="relative-time" class="time-ago" title="Wednesday, January 1, 2014 1:58 AM">
2 years ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Good news: I've pushed a new `peek()` method.</p><p>Bad news: I'm 
afraid there's really no safe way to add a "delete" operation without 
impacting the general-case performance of the queue as a whole (higher 
memory requirements and/or more processing for each element 
enqueued/dequeued) -- consider the case where the consumer is deleting a
 node while the producer is adding one; lots of care has to be taken to 
avoid corrupting the queue in this case. The elements can't simply be 
shifted over, for instance.</p><p>However, delete can be (safely) 
simulated on your own side using wrapper objects -- instead of 
enqueueing elements directly, enqueue a wrapper object that contains the
 element and a "deleted" flag (initially false). Then, simply set the 
flag when you want to "delete" the item, and check the flag as you 
dequeue the elements.</p><p>It sounds like you need a data structure 
that's more complex than a queue (some sort of lock-free linked list or 
vector, perhaps); can you elaborate on what larger problem you're trying
 to solve?</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1183022747">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1183022747">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"></ul>

</li></ul>

</li></ul>

</li></ul>

</li><li id="post-1085168004" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar">
<div class="user"><img src="a_data/noavatar92_002.png" class="user" alt="Avatar"></div>
</div>

<div class="post-body">
<header>
<span class="post-byline">
<span class="author">Oli</span>

</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1085168004" data-role="relative-time" class="time-ago" title="Wednesday, October 16, 2013 8:07 PM">
2 years ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Nice article. Would be good to compare performance with boost:spsc_queue too</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1085168004">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1085168004">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1085248966" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1085168004" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> Oli</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1085248966" data-role="relative-time" class="time-ago" title="Wednesday, October 16, 2013 9:37 PM">
2 years ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Thanks! Looking at the source of the boost spsc_queue, it should be 
roughly comparable to the Folly one (they are both based on fixed-sized 
ring buffers, which simplifies the logic a little (mine has to handle 
chained buffers in the worst case)).</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1085248966">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1085248966">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"></ul>

</li></ul>

</li><li id="post-1003909541" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/thanks_for_an_anon_commentsys/" class="user" data-action="profile" data-username="thanks_for_an_anon_commentsys">
<img data-role="user-avatar" data-user="66255026" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/thanks_for_an_anon_commentsys/" data-action="profile" data-username="thanks_for_an_anon_commentsys" data-role="username">thanks_for_an_anon_commentsys!</a></span>

</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1003909541" data-role="relative-time" class="time-ago" title="Friday, August 16, 2013 1:16 PM">
2 years ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Great stuff, someday I'd like to try to create a perl wrapper for this...</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1003909541">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1003909541">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"><li id="post-1003957669" class="post"><div role="alert"></div>
<div data-role="post-content" class="post-content">
<ul class="post-menu dropdown" data-role="menu">
<li class="collapse">
<a href="#" data-action="collapse" title="Collapse"><span>−</span></a>
</li>
<li class="expand">
<a href="#" data-action="collapse" title="Expand"><span>+</span></a>
</li>

<li class="" role="menu">
<a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate">
<i aria-hidden="true" class="icon icon-flag"></i>
</a>
</li>
</ul>
<div class="indicator"></div>

<div class="avatar hovercard">
<a href="https://disqus.com/by/cameron314/" class="user" data-action="profile" data-username="cameron314">
<img data-role="user-avatar" data-user="18992720" src="a_data/noavatar92_002.png" alt="Avatar">
</a>
</div>
<div class="post-body">
<header>
<span class="post-byline">
<span class="author publisher-anchor-color"><a href="https://disqus.com/by/cameron314/" data-action="profile" data-username="cameron314" data-role="username">Cameron</a></span>
<span class="badge moderator">Mod</span>

<span><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1003909541" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> thanks_for_an_anon_commentsys!</a></span>
</span>

<span class="post-meta">
<span class="bullet time-ago-bullet" aria-hidden="true">•</span>

<a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1003957669" data-role="relative-time" class="time-ago" title="Friday, August 16, 2013 2:02 PM">
2 years ago
</a>
</span>

</header>

<div class="post-body-inner">
<div class="post-message-container" data-role="message-container">
<div class="publisher-anchor-color" data-role="message-content">
<div class="post-message " data-role="message" dir="auto">
<p>Thanks :-) If you ever do create that wrapper let me know!</p>
</div>

<span class="post-media"><ul data-role="post-media-list"></ul></span>
</div>
</div>
<a class="see-more hidden" title="see more" data-action="see-more">see more</a>
</div>

<footer>
<menu>

<li class="voting" data-role="voting">
<a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up">

<span class="updatable count" data-role="likes">0</span>
<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>
</a>
<span role="button" class="vote-down  count-0" data-action="downvote" title="Vote down">

<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>
</span>
</li>
<li class="bullet" aria-hidden="true">•</li>


<li class="reply" data-role="reply-link">
<a href="#" data-action="reply">
<i class="icon icon-mobile icon-reply"></i><span class="text">Reply</span></a></li>
<li class="bullet" aria-hidden="true">•</li>


<li class="share">
<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">Share ›</span></a>
<ul>
<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>
<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>
<li class="link"><a href="http://moodycamel.com/blog/2013/a-fast-lock-free-queue-for-c++#comment-1003957669">Link</a></li>
</ul>
</li>

<li class="realtime" data-role="realtime-notification:1003957669">
<span style="display:none;" class="realtime-replies"></span>
<a style="display:none;" href="#" class="btn btn-small"></a>
</li>

</menu>
</footer>
</div>

<div data-role="blacklist-form"></div>
<div class="reply-form-container" data-role="reply-form"></div>
</div>

<ul data-role="children" class="children"></ul>

</li></ul>

</li></ul>

<div class="load-more" data-role="more" style="display:none">
<a href="#" data-action="more-posts" class="btn">Load more comments</a>
</div>
</div>

</section>

<div id="discovery" data-tracking-area="discovery-south"></div>
<div id="placement-bottom" data-tracking-area="discovery-south"></div>

<div id="footer" data-tracking-area="footer">
<ul>
<li class="logo"><a href="https://disqus.com/" rel="nofollow" title="Powered by Disqus">Powered by Disqus</a></li>
<li id="thread-subscribe-button" class="email"> 
<div class="default">
<a href="#" rel="nofollow" data-action="subscribe" title="Subscribe and get email updates from this discussion"><i aria-hidden="true" class="icon-mail"></i><span class="clip">Subscribe</span> <i aria-hidden="true" class="icon-checkmark"></i></a>
</div>
<div class="form">
<div class="input-wrapper"><input id="thread-subscribe-email" placeholder="yourname@email.com" type="email"></div>
</div>
</li>
<li class="install">
<a href="https://disqus.com/websites/?utm_source=moodycamel&amp;utm_medium=Disqus-Footer" rel="nofollow" target="_blank">
<i aria-hidden="true" class="icon-disqus"></i>
<span class="clip">Add Disqus to your site</span>
</a>
</li>
<li class="privacy">
<a href="https://help.disqus.com/customer/portal/articles/1657951?utm_source=disqus&amp;utm_medium=embed-footer&amp;utm_content=privacy-btn" rel="nofollow" target="_blank">
<i aria-hidden="true" class="icon-lock"></i>
<span class="clip">Privacy</span>
</a>
</li>
</ul>
</div>
</div></body></html>